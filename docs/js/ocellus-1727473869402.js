/* generated: Fri Sep 27 2024 23:51:09 GMT+0200 (Central European Summer Time) */
const e=e=>document.querySelector(e),t=e=>document.querySelectorAll(e),n={server:"localhost"===window.location.hostname?"http://localhost:3010/v3":"https://test.zenodeo.org/v3",mapServer:"localhost"===window.location.hostname?"http://localhost:3000":"https://maps.zenodeo.org",cache:{images:{yearlyCounts:!1,totals:!1},treatments:{yearlyCounts:!1,totals:!1},journals:null,collectionCodes:null,bins:{}},figureSize:{normal:250,small:100,tiny:50},defaultPlaceholder:"search images",results:{totalCount:0,figures:[],page:1,size:30},resources:["treatments","citations","images"],pseudoResources:["about","ip","contact","privacy"],params:{notValidQ:["resource","page","size","grid","refreshCache","cols"],validImages:["httpUri","caption","captionText","q","treatmentId","treatmentTitle","articleTitle","treatmentDOI","articleDOI","zenodoDep","authorityName","collectionCode","status","journalTitle","journals_id","journalYear","kingdom","phylum","class","family","order","genus","species","publicationDate","checkinTime","latitude","longitude","geolocation","isOnLand","validGeo","eco_name","biome","biome_id"],validTreatments:["treatmentId","treatmentTitle","treatmentDOI","zenodoDep","articleTitle","articleDOI","publicationDate","journalYear","authorityName","status","checkinTime","validGeo","q","latitude","longitude","geolocation","eco_name","biome","isOnLand","journalTitle","kingdom","phylum","class","family","order","genus","species"],validCommon:["refreshCache","page","size","cols","groupby"],notValidSearchCriteria:["resource","communities","communitiesChooser","refreshCache","view","size","page","reset","submit","source","grid"]},cols:{images:["treatmentId","treatmentTitle","zenodoDep","treatmentDOI","articleTitle","articleAuthor","httpUri","caption","latitude","longitude"],treatments:["treatmentId","treatmentTitle","zenodoDep","treatmentDOI","articleTitle","articleAuthor","journalTitle","latitude","longitude"]},maps:{},hiddenClasses:["hidden","noblock"],closedFigcaptionHeight:"30px",zenodoUri:"https://zenodo.org/records",tbUri:"https://tb.plazi.org/GgServer/html",H3ColorRamp:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],treatmentIcon:{iconUrl:"/img/treatment.svg",iconSize:[24,24],iconAnchor:[0,0],popupAnchor:[13,12]},treatmentIconHighlighted:{iconUrl:"/img/treatment-highlighted.svg",iconSize:[24,24],iconAnchor:[0,0],popupAnchor:[13,12]},months:["January","February","March","April","May","June","July","August","September","October","November","December"],charts:{termFreq:null,yearlyCounts:null}};function a(e){const t=document.getElementById("charts");let n=960;return t.offsetWidth<n&&(n=t.offsetWidth-100),e.style.display="block",e.style.width=`${n}px`,e.style.textAlign="center",e.style.margin="0 auto",e}function o(e,t){return e<1e3?e:e>=1e3&&e<1e6?e/1e3+"K":e>=1e6&&e<1e7?e/1e6+"M":void 0}const r=({yearlyCounts:e,totals:t})=>{const r=a(document.querySelector("#yearlyCounts"));r.innerHTML="";const i="Images",{years:s,series:l}=function(e,t){const n=[],a=[];"Treatments"===e||"Images"===e?(a.push({name:"Treatments",type:"bar",emphasis:{focus:"series"},data:t.map((e=>e.num_of_treatments))}),a.push({name:"Images",type:"bar",emphasis:{focus:"series"},data:t.map((e=>e.num_of_images))}),a.push({name:"Species",type:"bar",emphasis:{focus:"series"},data:t.map((e=>e.num_of_species))}),a.push({name:"Journals",type:"bar",emphasis:{focus:"series"},data:t.map((e=>e.num_of_journals))}),t.forEach((e=>n.push(e.year)))):(a.push({name:e,type:"bar",emphasis:{focus:"series"},data:t.map((t=>t[`num_of_${e.toLowerCase()}`]))}),t.forEach((e=>n.push(e.year))));return{years:n,series:a}}(i,e),c=function(e,t,n){return{legend:{left:65,top:60,orient:"horizontal",borderWidth:1,borderRadius:5,borderColor:"#444",backgroundColor:"#fff"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{precision:"0"}},formatter:'<div class="leg">\n    year {b}\n    <hr>\n    <div class="dot b"></div>{a0}: {c0}<br/>\n    <div class="dot g"></div>{a1}: {c1}<br/>\n    <div class="dot y"></div>{a2}: {c2}<br/>\n    <div class="dot r"></div>{a3}: {c3}\n</div>'},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",splitLine:{show:!1},data:t}],yAxis:[{type:"value",axisLabel:{formatter:o}}],series:n}}(0,s,l),d=document.createElement("div");d.style.width="100%",d.style.height="200px",d.classList.add("viz"),r.appendChild(d),n.charts.yearlyCounts=echarts.init(d),n.charts.yearlyCounts.setOption(c);const u=t.treatments,m=t.images,h=t.species,p=t.journals,f=c.xAxis[0].data,g=function({resource:e,imagesTotal:t,treatmentsTotal:n,speciesTotals:a,journalsTotals:o,num_of_years:r}){let i="Treatments"===e?`with <span>${t}</span> images, and`:`in <span>${n}</span> treatments of`;i+=` <span>${a}</span> species from <span>${o}</span> journals`,r&&(i+=` over <span>${r}</span> years`);return i}({resource:i,imagesTotal:m,treatmentsTotal:u,speciesTotals:h,journalsTotals:p,num_of_years:f[f.length-1]-f[0]}),y=document.createElement("div");y.style.width="100%",y.classList.add("caption"),r.appendChild(y),y.innerHTML=g};class i{constructor(e){this.el=e,this.summary=e.querySelector("summary"),this.content=e.querySelector("#charts"),this.animation=null,this.isClosing=!1,this.isExpanding=!1,this.summary.addEventListener("click",(e=>this.onClick(e)))}onClick(e){e.preventDefault(),this.el.style.overflow="hidden",this.isClosing||!this.el.open?this.open():(this.isExpanding||this.el.open)&&this.shrink()}shrink(){this.isClosing=!0;const e=`${this.el.offsetHeight}px`,t=`${this.summary.offsetHeight}px`;this.animation&&this.animation.cancel(),this.animation=this.el.animate({height:[e,t]},{duration:400,easing:"ease-out"}),this.animation.onfinish=()=>this.onAnimationFinish(!1),this.animation.oncancel=()=>this.isClosing=!1}open(){this.el.style.height=`${this.el.offsetHeight}px`,this.el.open=!0,window.requestAnimationFrame((()=>this.expand()))}expand(){this.isExpanding=!0;const e=`${this.el.offsetHeight}px`,t=`${this.summary.offsetHeight+this.content.offsetHeight}px`;this.animation&&this.animation.cancel(),this.animation=this.el.animate({height:[e,t]},{duration:400,easing:"ease-out"}),this.animation.onfinish=()=>this.onAnimationFinish(!0),this.animation.oncancel=()=>this.isExpanding=!1}onAnimationFinish(e){this.el.open=e,this.animation=null,this.isClosing=!1,this.isExpanding=!1,this.el.style.height=this.el.style.overflow=""}}function s(e,t){e.hasLayer(t)||e.addLayer(t)}function l(e,t,n){n in t&&e.hasLayer(t[n])&&e.removeLayer(t[n])}async function c(e,t){if("treatments"in t&&l(e,t,"treatments"),"h3"in t)s(e,t.h3);else{const a=await async function(e){const t=await fetch(`${n.server}/bins/${e}`);if(t.ok){const e={type:"FeatureCollection",features:[]},n=["81033ffffffffff","83f293fffffffff"],a=await t.json();n.forEach((e=>delete a[e]));for(const[t,n]of Object.entries(a)){const a=Math.round(h3.cellArea(t,h3.UNITS.km2)),o={type:"Feature",properties:{numOfTreatments:n,area:a,density:n/a},geometry:{type:"Polygon",coordinates:[h3.cellToBoundary(t).map((e=>[e[1],e[0]]))]}};e.features.push(o)}return d(e),e}alert("HTTP-Error: "+t.status)}(3),o=a.features.map((e=>e.properties.density)),r=1/Math.min(...o),i=function({data:e,scaleFactor:t,colorRamp:n,typeOfBins:a}){const o=n.length,r=[];if("equalWidth"===a){const t=Object.values(e);t.reduce(((e,t)=>e+t));const a=Math.max(...t)+1,i=Math.min(...t),s=(a-i)/o;let l=0;for(let e=i;e<a;e+=s){const t=e+s,a=n[l];r.push({from:Math.round(e),to:Math.round(t),fillColor:a,num:0}),l++}r.forEach((t=>{t.num=Object.values(e).filter((e=>e>=t.from&&e<t.to)).length}))}else if("equalFreq"===a){const a=Object.keys(e).length,i=Math.round(a/o),s=[];for(const[n,a]of Object.entries(e))s.push({id:n,num:Math.round(a*t)});const l=s.sort(((e,t)=>e.num-t.num));for(let e=0;e<o;e++){const t=e*i,a=t+i,o=l.slice(t,a),s=o[0].num,c=o[o.length-1].num;r[e]={from:s,to:c,fillColor:n[e],num:o.length}}}return r}({data:o,scaleFactor:r,colorRamp:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#b10026"],typeOfBins:"equalFreq"}),c=function(e){let t="#f5f5f5",n=0;const a=e.properties.density*r;return a>0&&(t=function(e,t){for(let n=0,a=t.length;n<a;n++)if(e>=t[n].from&&e<t[n].to)return t[n].fillColor}(a,i),n=.7),{fillColor:t,color:"grey",weight:0,fillOpacity:n}};l(e,t,"h3"),t.h3=L.geoJSON(a,{style:c,onEachFeature:(e,n)=>{n.on({mouseover:e=>{!function({mapLayers:e,bin:t}){e.h3info.update(t.feature.properties)}({mapLayers:t,bin:e.target})},mouseout:e=>{!function({mapLayers:e,bin:t}){e.h3info.update()}({mapLayers:t,bin:e.target})}})}}),s(e,t.h3),function(e,t){t.h3info=L.control(),t.h3info.onAdd=function(e){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},t.h3info.update=function(e){this._div.innerHTML=e?`${e.numOfTreatments} treatments in ${e.area} km<sup>2</sup>`:"Hover over a bin to see num of treatments"},t.h3info.addTo(e)}(e,t)}}function d(e){const{type:t}=e;if("FeatureCollection"===t)return void e.features.map(d);const{type:n,coordinates:a}=e.geometry;switch(n){case"LineString":return void u(a);case"Polygon":return void m(a);case"MultiPolygon":return void a.forEach((e=>m(e)));default:throw new Error(`Unknown geometry type: ${n}`)}}function u(e){let t=!1;for(let n=0;n<e.length;n++)if(Math.abs(e[0][0]-e[(n+1)%e.length][0])>180){t=!0;break}t&&e.forEach((e=>function(e){const t=e[0];e[0]=t<0?t+360:t}(e)))}function m(e){e.forEach((e=>u(e)))}async function h(e,t){if(console.log("drawing treatments"),"h3"in t&&l(e,t,"h3"),"treatments"in t)s(e,t.treatments);else{const a=e.getBounds(),o=await async function(e){const t=e.getSouthWest().lat,a=e.getSouthWest().lng,o=e.getNorthEast().lat,r=e.getNorthEast().lng,i=`${n.server}/treatments?geolocation=within(min_lat:${t},min_lng:${a},max_lat:${o},max_lng:${r})&cols=treatmentTitle&cols=latitude&cols=longitude&size=1000`,s=await fetch(i);if(s.ok)return(await s.json()).item.result.records;alert("HTTP-Error: "+s.status)}(a);t.treatments=L.markerClusterGroup();const r=L.icon({iconUrl:"/img/treatment.svg",iconSize:[24,24],iconAnchor:[0,0],popupAnchor:[13,12]});o.forEach((e=>{const a=new L.LatLng(e.latitude,e.longitude),o=L.marker(a,{icon:r}),i=e.treatmentId,s=`${n.server}/images?treatmentId=${i}&cols=httpUri&cols=captionText`,l=document.createElement("div");l.classList.add("my-class");const c=`<h4 class="popup">${e.treatmentTitle}</h4>`;o.bindPopup((()=>(async function(e,t,a,o){const r=await fetch(e);if(r.ok){const e=(await r.json()).item.result.records[0];if(e.httpUri){const a=250,r=e.httpUri.split("/")[4];o+=`<figure class="figure-${a}">\n                <picture>\n                    <img src="../img/bug.gif" width="${a}" data-src="${e.httpUri.indexOf("zenodo")>-1?`${n.server}/${r}/thumb${a}`:e.httpUri}" class="lazyload" data-recid="${r}">\n                </picture>\n                <figcaption>${e.captionText} <a href="${n.server}/treatments?treatmentId=${t}" target="_blank">more on TB</a></figcaption>\n            </figure>`}else o+=`<a href="${n.server}/treatments?treatmentId=${t}" target="_blank">more on TB</a>`;a.innerHTML=o}}(s,i,l,c),l))),t.treatments.addLayer(o)})),s(e,t.treatments)}}function p({baseLayerSource:e,map:t}){const a={minZoom:1,maxZoom:17,zoomOffset:-1,tileSize:512};let o;if("arcgis"===e)a.attribution="&copy; ESRI",o=L.tileLayer("https://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",a).addTo(t);else if("geodeo"===e){const e={ne_50m_admin_1_states_provinces_lakes:{maxZoom:2,tms:!0,styles:{weight:1,color:"blue",fillColor:"",fillOpacity:.5,fill:!0}},ne_50m_admin_0_countries:{maxZoom:2,tms:!0,styles:{weight:1,color:"#444",fillColor:"f5f5f5",fillOpacity:.25,fill:!0}},ne_10m_admin_1_sel:{maxZoom:5,tms:!0,styles:{weight:1,color:"#444",fillColor:"#f5f5f5",fillOpacity:.25,fill:!0}},nev:{maxNativeZoom:7,maxZoom:10,tms:!0,vectorTileLayerStyles:{playa:{stroke:!0,weight:1,color:"aliceblue",fillColor:"aliceblue",fillOpacity:.25,fill:!0},urban:{stroke:!0,weight:1,color:"bisque",fillColor:"bisque",fillOpacity:.25,fill:!0},water:{stroke:!0,weight:1,color:"black",fillColor:"lightblue",fillOpacity:.25,fill:!0},ice:function(e){return"glacier"===e.type?{weight:1,color:"white",fillColor:"white",fillOpacity:.45,fill:!0}:"ice_shelf"===e.type?{weight:1,color:"white",fillColor:"lightgrey",fillOpacity:.45,fill:!0}:void 0},river:{weight:1,color:"blue",fillColor:"",fillOpacity:1,fill:!1},railroad:{stroke:!0,weight:1,color:"brown"},road:{weight:1,color:"#ffcc00",fillColor:"",fillOpacity:1,fill:!1},country_label:{stroke:!1,fill:!1},state_label:{stroke:!1,fill:!1},marine_label:{stroke:!1,fill:!1},lake_label:{stroke:!1,fill:!1},place_label:{stroke:!1,fill:!1},airport_label:{stroke:!1,fill:!1},port_label:{stroke:!1,fill:!1},admin:function(e,t){const n=e.admin_level;return 0===n?{weight:1,color:"#444",fill:!1}:1===n?{weight:.5,color:"#444",fill:!1}:2===n?{weight:1,color:"#cf52d3",dashArray:"2, 6",fillColor:"green",fillOpacity:.25,fill:!0}:void 0}}},nev_raster:{maxZoom:15,tms:!0}};L.tileLayer(`${n.mapServer}/nev_raster/{z}/{x}/{y}`,{maxNativeZoom:6,maxZoom:10,tms:!0}).addTo(t);const a="nev",o=e[a];L.vectorGrid.protobuf(`${n.mapServer}/${a}/{z}/{x}/{y}`,o).addTo(t)}else if("gbif"===e){a.attribution='&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> / &copy; <a href="https://www.openmaptiles.org/copyright">OpenMapTiles</a>';const e=parseInt(window.devicePixelRatio)||1;o=L.tileLayer("https://tile.gbif.org/3857/omt/{z}/{x}/{y}@{r}x.png?style=gbif-natural".replace("{r}",e),a).addTo(t)}return o}function f({mapContainer:t,baseLayerSource:n,drawControl:a}){const o=L.map(t).setView([0,0],2);o.attributionControl.setPrefix("");const r={baseLayer:p({baseLayerSource:n,map:o})};a&&function(t,n){n.drawControls=new L.FeatureGroup,s(t,n.drawControls);const a={position:"topleft",draw:{polyline:!1,polygon:!1,circle:{shapeOptions:{weight:1}},rectangle:{shapeOptions:{clickable:!1,weight:1}},circlemarker:!1,marker:!1},edit:{featureGroup:n.drawControls}},o=new L.Control.Draw(a);t.addControl(o),t.on(L.Draw.Event.CREATED,(function(t){const a=t.layerType,o=t.layer,r=e("#coords"),i=e("input[name=as-geolocation");if("rectangle"===a){const e=o.toGeoJSON().geometry.coordinates,[t,n,a,s,l]=e[0],c=t[1].toFixed(2),d=t[0].toFixed(2),u=a[1].toFixed(2),m=a[0].toFixed(2);r.innerHTML=`lower left: lat ${c}, lng: ${d}; upper right: lat ${u}, lng ${m}`,i.value=`within(min_lat:${c},min_lng:${d},max_lat:${u},max_lng:${m})`}else if("circle"===a){const e=t.layer.getLatLng(),n=e.lng.toFixed(2),a=e.lat.toFixed(2),o=(t.layer.getRadius()/1e3).toFixed(2);r.innerHTML=`within ${o} kms of ${n}, ${a}`,i.value=`within(radius:${o},units:'kilometers',lat:${a},lng:${n})`}n.drawControls.addLayer(o)})),t.on(L.Draw.Event.DELETED,(function(t){e("input[name=as-geolocation").value="",e("#coords").innerHTML=""}))}(o,r),function(e,t){e.getZoom()<=5?c(e,t):h(e,t)}(o,r),o.on("moveend",(function(e){c(o,r)}))}function g(t){const n=e("input[name=resource]").checked?"treatments":"images",a=`${t.target.parentNode.href}&resource=${n}`;history.pushState({},"",a);const o=new URL(location);let r;o.search&&(r=o.search.substring(1)),N(r);const i=J();R(i),t.preventDefault(),t.stopPropagation()}function y(t){if("/"===t.key){if(/^(?:input|textarea|select|button)$/i.test(t.target.tagName))return;const n=e("#q");n.setSelectionRange(0,n.value.length),n.focus(),t.preventDefault()}}const $=t=>{const n=e(".examples").classList;n.contains("hidden")?n.remove("hidden"):n.add("hidden")},v=e=>{const t=e.target.classList;t.contains("required")&&t.remove("required")},b=t=>{log.info("- toggling advanced search"),e("#as-container").classList.toggle("noblock");e("input[name=searchtype]").checked?(e("#q").value="",e("#q").placeholder="use advanced search below",e("#q").disabled=!0,e("#refreshCache").disabled=!0,e("#clear-q").disabled=!0,e('input[name="as-q"]').focus(),f({mapContainer:"mapSearch",baseLayerSource:"gbif",drawControl:!0})):(e("#q").placeholder=n.defaultPlaceholder,e("#q").disabled=!1,e("#refreshCache").disabled=!1,e("#clear-q").disabled=!1)},w=t=>{const n=e("input[name=resource]").checked?"treatments":"images";G(n)},x=e=>{if(e.target.open){var n=t("details[open]");Array.prototype.forEach.call(n,(function(t){t!==e.target&&t.removeAttribute("open")}))}},T=n=>{e("#q").value=n.target.textContent,e("#ns-go").classList.add("glowing");t("input[name=source").forEach((e=>{"treatments"===e.value&&(e.checked=!0)})),$(),n.stopPropagation(),n.preventDefault()},C=t=>{e("#refreshCache").toggleAttribute("data-pop-show")},k=t=>{""===e("#q").value?(E(),setTimeout(q,4e3)):(e("#q").classList.remove("red-placeholder"),e("#throbber").classList.remove("nothrob"),e("#ns-go").classList.remove("glowing"),Z()),t.stopPropagation(),t.preventDefault()},_=t=>{e("#throbber").classList.remove("nothrob"),Z(),t.stopPropagation(),t.preventDefault()},S=a=>{const o=new URL(a.target.href).hash,r=t(".modal");o.length>0?(r.forEach((e=>{e.classList.add(...n.hiddenClasses)})),e(o).classList.remove(...n.hiddenClasses)):r.forEach((e=>e.classList.add(...n.hiddenClasses)))},E=()=>{e("#q").placeholder="c'mon, type something",e("#q").classList.add("red-placeholder")},q=t=>{e("#q").placeholder=n.defaultPlaceholder,e("#q").classList.remove("red-placeholder"),e("#refreshCache").checked=!1},z=t=>{t.target.innerHTML='<a href="#map" id="mapInit">MAP</a> • IMAGES • TREATMENTS',t.target.querySelector("#mapInit").addEventListener("click",j),e("#brand").classList.add("smallbrand"),e("#brand").removeEventListener("click",z),setTimeout((()=>{t.target.innerHTML=4,e("#brand").classList.remove("smallbrand"),e("#brand").addEventListener("click",z)}),2e3),t.stopPropagation(),t.preventDefault()},j=e=>{f({mapContainer:"map",baseLayerSource:"geodeo",drawControl:!1})};function O(e){const t=e.querySelector(".next"),a=e.querySelector(".prev");let o=0;const r=e.querySelectorAll(".content .slide"),i=r.length;let s=r[0];function l(e){s.classList.remove("current"),o+=e,-1===e&&o<0&&(o=i-1),1!==e||r[o]||(o=0),s=r[o],s.classList.add("current")}e.classList.add("active"),t.addEventListener("click",(function(e){l(1),function(e){const t=e.currentTarget;if(!n.maps[t.dataset.id]){const e=L.map(`map-${t.dataset.id}`);n.maps[t.dataset.id]=e;const a="http://services.arcgisonline.com/arcgis/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}";L.tileLayer(a,{maxZoom:19,attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(e);const o=L.icon({iconUrl:"img/treatment.svg",iconSize:[10,10],iconAnchor:[5,5]});let r;if("undefined"!==t.dataset.loc){JSON.parse(t.dataset.loc).map((e=>[e.latitude,e.longitude])).forEach(((t,n)=>{0===n&&(r=t),L.marker(t,{icon:o}).addTo(e)})),e.setView(r,10)}else if(t.dataset.convexhull){const n=JSON.parse(t.dataset.convexhull),a=L.polygon(n,{color:"#9BC134",weight:1}).addTo(e);n.forEach(((t,n)=>{L.marker(t,{icon:o}).addTo(e)})),e.fitBounds(a.getBounds())}}}(e)})),a.addEventListener("click",(function(e){l(-1)})),l(0)}const I=e=>{const n=e.target.name;if("between"===e.target.value){t(`#${n}-range .hidden`).forEach((e=>{e.classList.contains("hidden")&&(e.classList.remove("hidden"),e.classList.add("vis"))}))}else{t(`#${n}-range .vis`).forEach((e=>{e.classList.add("hidden"),e.classList.remove("vis")}))}};function H(e,t){const n=document.getElementById("tooltip");n.innerHTML=t,n.style.display="block",n.style.left=e.offsetX+"px",n.style.top=e.offsetY+"px"}function F(){document.getElementById("tooltip").style.display="none"}function M({resource:e,figureSize:t,rec:a}){const o="images"===e?(({figureSize:e,rec:t})=>{const a=t.zenodoRec?`<img src="img/zenodo-gradient-35.png" width="35" height="14"> <a href="${n.zenodoUri}/${t.zenodoRec}" target="_blank">more on Zenodo</a>`:"",o=`<img src="img/treatmentBankLogo.png" width="35" height="14"> <a href="${n.tbUri}/${t.treatmentId}" target="_blank">more on TreatmentBank</a>`,r=250===e?"visible":"noblock",i=`figure-${e}`+(t.treatmentId?" tb":""),s=`this.onerror=null; setTimeout(() => { this.src='${t.uri}' }, 1000);`,l=t.loc||t.convexHull?"this.parentNode.parentNode.parentNode.parentNode.style.height=this.height+150+'px'":"";return`<figure class="${i}">\n    <a class="zen" href="${t.fullImage}">\n\n            <img src="img/bug.gif" width="${t.figureSize}" \n                data-src="${t.uri}" \n                class="lazyload" \n                data-recid="${t.treatmentId}" \n                onerror="${s}"\n                onload="${l}">\n        \n    </a>\n    <figcaption class="${r}">\n        <details>\n            <summary class="figTitle" data-title="${t.treatmentTitle}">\n                ${t.treatmentTitle}\n            </summary>\n            <p>${t.captionText}</p>\n            ${o}<br>\n            ${a}\n        </details>\n    </figcaption>\n</figure>`})({figureSize:t,rec:a}):(({figureSize:e,rec:t})=>{let a="";t.zenodoRec&&(a=`<a href="${n.zenodoUri}/${t.zenodoRec}" target="_blank" title="more on Zenodo" alt="more on Zenodo"><img class="zenodoLink" src="img/zenodo-gradient-round.svg" width="50"></a>`);const o=250===e?"visible":"noblock",r=`figure-${e} `+(t.treatmentId?"tb":""),i=t.treatmentDOI?`<a href="https://dx.doi.org/${t.treatmentDOI}">${t.treatmentDOI}</a>`:"";let s="";return t.articleTitle&&(s+=`<span class="articleTitle">${t.articleTitle}</span>`),t.articleAuthor&&(s+=` by <span class="articleAuthor">${t.articleAuthor}</span>`),t.journalTitle&&(s+=` in <span class="journalTitle">${t.journalTitle}</span>`),i&&(s+=`. ${i}`),`<figure class="${r}">\n    <p class="treatmentTitle">${t.treatmentTitle}</p>\n    <p class="citation">${s}</p>\n    <figcaption class="${o}">\n        \x3c!--  --\x3e\n        <div>\n            ${a} <a href="${n.tbUri}/${t.treatmentId}" target="_blank" title="more on TreatmentBank" alt="more on TreatmentBank"><img class="tbLink" src="img/treatmentBankLogo.png" width="100"></a>\n        </div>\n    </figcaption>\n</figure>`})({figureSize:t,rec:a}),r="images"===e?`${a.treatments_id}-${a.images_id}`:a.treatments_id;return a.loc||a.convexHull?`\n        <div class="carouselbox">\n\n            <div class="buttons">\n                <button class="prev">\n                    ◀ <span class="offscreen">Previous</span>\n                </button>\n                <button class="next" \n                    data-loc=${JSON.stringify(a.loc)} \n                    data-convexhull=${JSON.stringify(a.convexHull)} \n                    data-id="${r}">\n                    <span class="offscreen">Next</span> ▶︎\n                </button>\n            </div> \n\n            <div class="content">\n                <div class="slide">\n                    ${o}\n                </div>\n                <div id="map-${r}" class="map slide"></div>\n            </div>\n        </div>`:`\n        <div class="slidr">\n            ${o}\n        </div>`}const A=({resource:t,figureSize:i,slides:s,qs:l,count:c,term:d,termFreq:u,yearlyCounts:m,prev:h,next:p,stored:f,ttl:g,cacheHit:y})=>{log.info(`- renderPage()\n    - figureSize: ${i}px\n    - figures: ${s.length} slides\n    - qs: ${l}\n    - count: ${c}\n    - prev: ${h}\n    - next: ${p}`),e("#grid-images").classList.add(`columns-${i}`),D(s),U(l,h,p),e("#throbber").classList.add("nothrob"),n.charts.termFreq&&(n.charts.termFreq.dispose(),e("#termFreq").style.visibility="hidden"),u&&u.length&&(((e,t)=>{const r=a(document.querySelector("#termFreq"));r.innerHTML="";const i="all",s="with images",l={legend:{left:55,top:60,orient:"vertical",borderWidth:1,borderRadius:5,borderColor:"silver",backgroundColor:"#fff"},tooltip:{trigger:"axis",formatter:'<div class="leg">\n    year {b}\n    <hr>\n    {a0}: {c0}<br/>\n    {a1}: {c1}\n</div>'},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",splitLine:{show:!1},data:t.map((e=>e.journalYear))},yAxis:{type:"log",minorSplitLine:{show:!0},axisLabel:{formatter:o}},series:[{name:i,type:"line",data:t.map((e=>0==e.total?null:e.total)),color:"#f00",lineStyle:{color:"#f00",width:1}},{name:s,type:"line",data:t.map((e=>0==e.withImages?null:e.withImages)),color:"#00f",lineStyle:{color:"#00f",width:1}}]},c=document.createElement("div");c.style.width="100%",c.style.height="150px",c.classList.add("viz"),r.appendChild(c),n.charts.termFreq=echarts.init(c),n.charts.termFreq.setOption(l);const d=document.createElement("div");d.style.width="100%",d.classList.add("caption"),r.appendChild(d),d.innerHTML=`occurrence of <span>${e}</span> in the text by year`})(d,u),e("#termFreq").style.visibility="visible"),function(t,a,o,r,i){log.info("- renderSearchCriteria()");const s=new URLSearchParams(t);let l=s.get("resource");const c=[],d=[],u=[];n.params.notValidSearchCriteria.forEach((e=>s.delete(e)));const m='<span class="crit-key">',h='<span class="crit-val">',p='<span class="crit-count">',f="</span>",g={checkinTime:"checked in",updateTime:"updated",publicationDate:"published"};a?a<10&&(a=B(a)):a="Sorry, no";c.push(`${p}${a}${f}`),1===a&&(l=l.slice(0,-1));c.push(l),s.forEach(((e,t)=>{let n;if(Object.keys(g).includes(t)){const o=e.match(/(?<operator1>eq|since|until)?\((?<date>[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}|yesterday)\)|(?<operator2>between)?\((?<from>[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}|yesterday)\s*and\s*(?<to>[0-9]{4}-[0-9]{1,2}-[0-9]{1,2}|yesterday)\)/);if(o){if(n=`${m}${g[t]}${f}`,o.groups.operator1){let e;e="since"===o.groups.operator1?1===a?"has been":"have been":1===a?"was":"were",c.push(e),"eq"===o.groups.operator1?n+=" on":n+=` ${o.groups.operator1}`,n+=` ${h}${o.groups.date}${f}`}else o.groups.operator2&&(n+=` ${h}between${f} ${h}${o.groups.from}${f} and ${h}${o.groups.to}${f}`);d.push(n)}}else{const a=e.match(/(?<operator>\w+)\((?<term>[\w\s]+)\)/);if(a){const{operator:e,term:o}=a.groups;n=`${m}${t}${f}${e.replace(/_/," ")} ${h}${o}${f}`}else if("q"===t)n=`${m}${e}${f} is in the text`;else if("captionText"===t)n=`${m}${e}${f} is in ${m}caption text${f}`;else if("geolocation"===t){const t=new RegExp("(?<operator>within)\\((radius:s*(?<radius>([+-]?([0-9]+)(.[0-9]+)?)),s*units:s*['\"](?<units>kilometers|miles)['\"],s*lat:s*(?<lat>([+-]?([0-9]+)(.[0-9]+)?)),s*lng:s*(?<lng>([+-]?([0-9]+)(.[0-9]+)?))|min_lat:s*(?<min_lat>([+-]?([0-9]+)(.[0-9]+)?)),min_lng:s*(?<min_lng>([+-]?([0-9]+)(.[0-9]+)?)),max_lat:s*(?<max_lat>([+-]?([0-9]+)(.[0-9]+)?)),max_lng:s*(?<max_lng>([+-]?([0-9]+)(.[0-9]+)?)))\\)"),a=e.match(t);if(a){let{operator:e,radius:t,units:o,lat:r,lng:i,min_lat:s,min_lng:l,max_lat:c,max_lng:d}=a.groups;t?(i=Number(i).toFixed(2),r=Number(r).toFixed(2),n=`${m}location${f} is within ${h}${t}${f} ${h}${o}${f} of ${h}lat ${r}${f} and ${h}lng ${i}${f}`):(l=Number(l).toFixed(2),s=Number(s).toFixed(2),d=Number(d).toFixed(2),c=Number(c).toFixed(2),n=`${m}location${f} is within a box with ${m}lower left corner${f} at ${h}lat ${s}, lng ${l}${f} and ${m}upper right corner${f} at ${h}lat ${c}, lng ${d}${f}`)}}else t=t.split(/([A-Z][a-z]+)/).filter((function(e){return e})).map((e=>e.toLowerCase())).join(" "),n=`${m}${t}${f} is ${h}${e}${f}`;u.push(n)}}));const y=[];d.length?y.push(...d):c.push("found");u.length&&c.push("where");let $;y.push(...u);const v=y.length;$=1===v?y[0]:2===v?`${y[0]} and ${y[1]}`:`${y.slice(0,v-2).join(", ")}, and ${y[v-1]}`;if(c.push($),i){const e=new Date(o),t=new Date(o+r)-new Date;c.push(`<span aria-label="cache hit, stored ${Y(e)}, expires in ${K(t)}" data-html="true" data-pop="top" data-pop-no-shadow data-pop-arrow data-pop-multiline>💥</span>`)}e("details.charts summary").innerHTML=c.join(" "),e("#charts-container summary").style.visibility="visible"}(l,c,f,g,y),n.charts.yearlyCounts&&(n.charts.yearlyCounts.dispose(),e("#yearlyCounts").style.visibility="hidden"),m&&(r({yearlyCounts:m.yearlyCounts,totals:m.totals}),e("#yearlyCounts").style.visibility="visible"),(u||m)&&(e("#charts").style.visibility="visible");e("input[name=searchtype]").checked&&(e("input[name=searchtype]").checked=!1,b(),N(l)),"images"===t&&new SimpleLightbox({elements:"figure",loadingCaption:'<img src="../../img/bug.gif">'})},D=(n,a,o,r)=>{log.info("- renderSlides()"),n.length?(e("#grid-images").innerHTML=n.join(""),(()=>{const e=t("figcaption > details");for(let t=0,n=e.length;t<n;t++)e[t].addEventListener("toggle",(n=>{const a=n.target.querySelector("summary"),o=a.dataset.title,r=o.length>30?`${o.substring(0,30)}…`:o;e[t].open?a.innerText=o:a.innerText=r}))})(),(()=>{const e=t("figure .reveal");for(let t=0,n=e.length;t<n;t++)e[t].addEventListener("click",z)})(),t(".carouselbox").forEach((e=>{O(e)}))):e("#grid-images").innerHTML=""},U=(t,n,a)=>{log.info("- renderPager()"),log.info(`  - qs: ${t}`),log.info(`  - prev: ${n}`),log.info(`  - next: ${a}`);const o=new URLSearchParams(t);o.delete("page"),e("#pager").innerHTML=`<a href="?${o.toString()}&page=${n}">prev</a> <a href="?${o.toString()}&page=${a}">next</a>`,e("#pager").classList.add("filled"),log.info("- listeners.addListenersToPagerLinks()")};const R=async t=>{log.info("- getResource(qs)"),e("#throbber").classList.remove("nothrob");const a=new URLSearchParams(t),o=a.get("page"),r=a.get("size"),i=a.get("grid")||"normal",s=n.figureSize[i],l=a.get("resource");let c;a.delete("resource"),a.has("q")&&(c=a.get("q"));const d="images"===l?n.params.validImages:n.params.validTreatments;d.push(...n.params.validCommon);let u=!0;if(Array.from(a).forEach((([t,n])=>{var o;d.includes(t)?n||(a.set("q",t),a.delete(t),c=t):(o=`"${t}" is not a valid param`,e(".warn").classList.contains("hidden")&&(e(".warn").innerHTML=o,e(".warn").classList.remove("hidden"),e("#throbber").classList.add("nothrob"),setTimeout((()=>{e(".warn").innerHTML="",e(".warn").classList.add("hidden")}),3e3)),u=!1)})),!1===u)return;const m="images"===l?`${n.cols.images.join("&cols=")}`:`${n.cols.treatments.join("&cols=")}`;let h=`${a.toString()}&cols=${m}`;c&&(h+="&termFreq=true"),a.has("treatmentId")||(h+="&yearlyCounts=true");const p=[];p.push(P({resource:l,queryString:h,figureSize:s})),Promise.all(p).then((e=>{const t={resource:l,prev:o>1?o-1:1,next:parseInt(o)+1,size:r,count:0,recs:[]};return e.forEach((e=>{void 0!==e&&(t.recs.push(...e.recs),t.count+=e.count,t.termFreq=e.termFreq,t.yearlyCounts=e.yearlyCounts,t.cacheHit=e.cacheHit,t.stored=e.stored,t.ttl=e.ttl)})),t})).then((e=>{const n=e.recs.map((e=>M({resource:l,figureSize:s,rec:e}))),a={resource:l,figureSize:s,slides:n,qs:t,count:e.count,prev:e.prev,next:e.next,stored:e.stored,ttl:e.ttl,cacheHit:e.cacheHit};e.termFreq&&(a.termFreq=e.termFreq,a.term=c),e.yearlyCounts&&(a.yearlyCounts=e.yearlyCounts),A(a)}))},P=async({resource:e,queryString:t,figureSize:a})=>{log.info(`- getResults({ resource, queryString, figureSize })\n    - resource: ${e}\n    - queryString: ${t},\n    - figureSize: ${a}`);const o=`${n.server}/${e}?${t}`,r=await fetch(o);if(r.ok){const t=await r.json(),o=t.item.result.records;let i;if(t.item.result.yearlyCounts){i={};const e=t.item.result.yearlyCounts,n=e.reduce(((e,t)=>(e.images+=t.num_of_images,e.treatments+=t.num_of_treatments,e.species+=t.num_of_species,e.journals+=t.num_of_journals,e)),{images:0,treatments:0,species:0,journals:0});i.yearlyCounts=e,i.totals=n}const s={resource:e,count:0,recs:[],termFreq:t.item.result.termFreq,yearlyCounts:i,prev:"",next:"",stored:t.stored,ttl:t.ttl,cacheHit:t.cacheHit||!1};if(o)return s.count=s.count+t.item.result.count,o.forEach((t=>{const o={};if("images"===e){o.treatmentId=t.treatmentId,o.treatments_id=t.treatments_id,o.images_id=t.images_id,o.treatmentTitle=t.treatmentTitle,o.zenodoRec=t.zenodoDep,o.figureSize=a;const e=t.httpUri.split("/")[4];t.httpUri.indexOf("zenodo")>-1?t.httpUri.indexOf(".svg")>-1?(o.uri="/img/kein-preview.png",o.fullImage="/img/kein-preview.png"):(o.uri=`https://zenodo.org/api/iiif/record:${e}:figure.png/full/250,/0/default.jpg`,o.img=`${n.zenodoUri}/${e}/thumb${a}`,o.fullImage=`https://zenodo.org/api/iiif/record:${e}:figure.png/full/^1200,/0/default.jpg`,o.fullImg=`${n.zenodoUri}/${e}/thumb1200`):(o.uri=`${t.httpUri}/singlefigAOF/`,o.fullImage=t.httpUri),o.captionText=t.captionText,o.treatmentDOI=t.treatmentDOI,o.articleTitle=t.articleTitle,o.articleAuthor=t.articleAuthor,o.latitude=t.latitude,o.longitude=t.longitude,o.loc=t.loc,t.convexHull?o.convexHull=t.convexHull[0].map((([e,t])=>[t,e])):o.convexHull=void 0}else"treatments"===e&&(o.treatmentId=t.treatmentId,o.treatments_id=t.treatments_id,o.treatmentTitle=t.treatmentTitle,o.zenodoRec=t.zenodoDep,o.figureSize=a,o.journalTitle=t.journalTitle,o.treatmentDOI=t.treatmentDOI,o.articleTitle=t.articleTitle,o.articleAuthor=t.articleAuthor,o.latitude=t.latitude,o.longitude=t.longitude,o.loc=t.loc,t.convexHull?o.convexHull=t.convexHull[0].map((([e,t])=>[t,e])):o.convexHull=void 0);s.recs.push(o)})),s}else alert("HTTP-Error: "+r.status)},N=t=>{log.info(`- qs2form(qs)\n    - qs: ${t}`);const a=new URLSearchParams(t);a.delete("refreshCache");const o=[];a.forEach(((t,a)=>{if(log.info(`val: ${t}, key: ${a}`),n.params.notValidQ.includes(a))"resource"===a?(log.info(`setting form to query resource ${t}`),G(t),"treatments"===t?(log.info("setting toggle-resource to true"),e("input[name=resource]").checked=!0):(log.info("setting toggle-resource to false"),e("input[name=resource]").checked=!1)):(log.info(`setting input name ${a} to ${t}`),e(`input[name=${a}]`).value=t);else{let e=a;t&&(e="q"===a?decodeURIComponent(t):`${a}=${t}`),o.push(e)}})),e("#q").value=o.join("&")},B=e=>e<10?["One","Two","Three","Four","Five","Six","Seven","Eight","Nine"][e-1].toLowerCase():e,Z=()=>{log.info("submitForm()");const e=J();if(!e)return!1;W(e),R(e)},G=async t=>{const a=await(async(e,t)=>{if(!n.cache[e].yearlyCounts){let a=`${n.server}/${e}?cols=`;t&&(a+="&yearlyCounts=true");const o=await fetch(a);if(o.ok){const a=await o.json(),r=a.item.result.count;if(t){const t=a.item.result.yearlyCounts,o=t.reduce(((e,t)=>(e.images+=t.num_of_images,e.treatments+=t.num_of_treatments,e.species+=t.num_of_species,e.journals+=t.num_of_journals,e)),{images:0,treatments:0,species:0,journals:0});n.cache[e].yearlyCounts=t,n.cache[e].totals=o}else n.cache[e].totals[e]=r}else alert("HTTP-Error: "+o.status)}return n.cache[e]})(t,!0);((t,n)=>{let{images:a,treatments:o,species:r,journals:i}=n.totals;const s=n.yearlyCounts;let l="images"===t?a:o;e("#q").placeholder=`search ${t}`;const c=s.length,d=3*c;Math.max(...s);const u=40/l;function m(e,n,a,o,r,i,s){return`<g class="${n}" transform="translate(${e*r},0)">\n            <rect height="${a}" y="${o-a}" width="${r}" onmousemove="showTooltip(evt, '${i}: ${s} ${t}');" onmouseout="hideTooltip();"></rect>\n        </g>`}let h=`<svg id="svgSpark" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="chart" height="40" width="${d}" aria-labelledby="title" role="img">`;for(let e=0;e<c;e++){const n=s[e].year,a=s[e][`num_of_${t}`];h+=m(e,"bar",a*u,40,3,n,a)}h+="</svg>";const p=document.querySelector("#sparkBox");let f=h;l=Math.round(l/1e3,0),o=Math.round(o/1e3,0),a=Math.round(a/1e3,0),r=Math.round(r/1e3,0),i=Math.round(i/1e3,0),f+="images"===t?` <span>~${l}K</span> ${t}, <span>~${o}K</span> treatments, `:`<span>~${l}K</span> ${t}, <span>~${a}K</span> images, `,f+=`<span>~${r}K</span> species, <span>~${i}K</span> journals`,p.innerHTML=f})(t,a),e("#q").placeholder=`search ${t}`},J=()=>{const n=new URLSearchParams,a=!0===e("input[name=searchtype").checked?"as":"ss";let o=!0;if("ss"===a)log.info("- form2qs(): simple search"),Array.from(t("form input.query")).filter((e=>e.value)).forEach((e=>{let t=e.name,a=e.value;if("q"===e.name){const o=e.value.replaceAll(/ & /g,"%20%26%20");new URLSearchParams(o).forEach(((e,o)=>{if(""===e){const e=a.match(/(^10\.[0-9]{4,}.*)/);e&&e[1]?(t="articleDOI",a=e[1]):(t="q",a=o)}else t=o,a=e;n.append(t,a)}))}else"radio"===e.type||"checkbox"===e.type?"resource"===e.name?e.checked||"true"===e.checked?n.append(t,a):n.append(t,"images"):(e.checked||"true"===e.checked)&&n.append(t,a):n.append(t,a)}));else if("as"===a){log.info("- form2qs(): advanced search");["page","size","resource","refreshCache"].forEach((t=>{const a=e(`input[name=${t}]`);"resource"===t?a.checked||"true"===a.checked?n.append(t,a.value):n.append(t,"images"):(a.checked||"true"===a.checked)&&n.append(t,a.value)}));["q","treatmentTitle","authorityName","articleTitle","journalTitle","journals_id","collectionCode"].forEach((t=>{const a=e(`input[name="as-${t}"]`);a.value&&n.append(t,a.value)}));["status","refreshCache"].forEach((t=>{const a=e(`input[name="as-${t}"]`);(a.checked||"true"===a.checked)&&n.append(t,a.value)}));const t=["journalYear","publicationDate","checkinTime","biome"],a=t=>{const a=e(`select[name="as-${t}"]`),o=a.selectedIndex,r=a.options[o].value;if(r)if("journalYear"===t)n.append(t,r);else if("biome"===t)n.append(t,r);else if("between"===r){const a=e(`input[name="as-${t}From`),o=a.value,r=e(`input[name="as-${t}To`),i=r.value;if(o&&i)n.append(t,`between(${o} and ${i})`);else{let e=!0;if(""===o&&(a.classList.add("required"),e=!1),""===i&&(r.classList.add("required"),e=!1),!e)return!1}}else{const a=e(`input[name="as-${t}From`);console.log(t);const o=a.value;if(!o)return a.classList.add("required"),!1;n.append(t,`${r}(${o})`)}return!0};for(const e of t){if(!a(e)){o=!1;break}}["geolocation"].forEach((t=>{const a=e(`input[name="as-${t}"]`);a.value&&n.append(t,a.value)}))}if(o){const e=n.toString();return console.log(e),e}return console.log("false"),!1},W=e=>{log.info("- updateUrl(qs)");const t=`?${e}`;history.pushState({},"",t)},K=e=>{const t=36e5,n=864e5;let a=Math.floor(e/n),o=Math.floor((e-a*n)/t),r=Math.round((e-a*n-o*t)/6e4);const i=e=>e<10?"0"+e:e;return 60===r&&(o++,r=0),24===o&&(a++,o=0),`${a} days ${i(o)} hours ${i(r)} mins`},Y=e=>{const t=e.getFullYear(),a=e.getMonth(),o=e.getDate(),r=e.getHours(),i=e.getMinutes(),s=e.getSeconds();return`${o} ${n.months[a]}, ${t} ${r}:${i}:${s}`};async function V(){if(n.cache.collectionCodes)return n.cache.collectionCodes;{const e=`${n.server}/collectioncodes?cols=collectionCode&cols=name&size=4300`,t=await fetch(e);if(t.ok){const e=(await t.json()).item.result.records;if(e)return n.cache.collectionCodes=e.map((e=>({collectionCode:e.collectionCode,name:e.name}))),n.cache.collectionCodes}else alert("HTTP-Error: "+t.status)}}async function Q(){if(n.cache.journals)return n.cache.journals;{const e=`${n.server}/journals?size=1100&sortby=journalTitle:asc`,t=await fetch(e);if(t.ok){const e=(await t.json()).item.result.records;if(e)return n.cache.journals=e.map((e=>({journals_id:e.journals_id,journalTitle:e.journalTitle}))),n.cache.journals}else alert("HTTP-Error: "+t.status)}}function X(){new autoComplete({selector:'input[name="as-journalTitle"]',minChars:2,source:async function(e,t){e=e.toLowerCase();const n=await Q(),a=[];for(let t=0;t<n.length;t++)~n[t].journalTitle.toLowerCase().indexOf(e)&&a.push({journals_id:n[t].journals_id,journalTitle:n[t].journalTitle});t(a)},renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");const n=new RegExp("("+t.split(" ").join("|")+")","gi"),a=e.journalTitle.replace(n,"<b>$1</b>");return`<div class="autocomplete-suggestion" data-id="${e.journals_id}" data-val="${e.journalTitle}">${a}</div>`},onSelect:function(e,t,n){document.querySelector(keySelector).value=n.getAttribute("data-id")}})}function ee(){new autoComplete({selector:'input[name="as-collectionCode"]',minChars:2,source:async function(e,t){e=e.toLowerCase();const n=await V(),a=[];for(let t=0;t<n.length;t++)~n[t].collectionCode.toLowerCase().indexOf(e)&&a.push({collectionCode:n[t].collectionCode,name:n[t].name});t(a)},renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");const n=new RegExp("("+t.split(" ").join("|")+")","gi");let a=e.collectionCode.replace(n,"<b>$1</b>");return e.name&&(a+=` (${e.name})`),`<div class="autocomplete-suggestion" data-id="${e.collectionCode}">${a}</div>`},onSelect:function(e,t,n){document.querySelector('input[name="as-collectionCode"]').value=n.getAttribute("data-id")}})}var te;function ne(){const n=new URL(location);if(n.search){log.info(`- locSearch: ${n.search.substring(1)}`),N(n.search.substring(1));const e=J();R(e)}else G("images");log.info("- addListeners()"),e("#refreshCache").addEventListener("click",C),e("#ns-go").addEventListener("click",k),e("#as-go").addEventListener("click",_),e("#q").addEventListener("focus",q),e("#search-help").addEventListener("click",$),e("div.examples").addEventListener("toggle",x,!0),t(".modalToggle").forEach((e=>e.addEventListener("click",S))),e("#brand").addEventListener("click",z),t(".example-insert").forEach((e=>e.addEventListener("click",T))),e("input[name=searchtype").addEventListener("click",b),e("input[name=resource").addEventListener("click",w),e('select[name="as-publicationDate"]').addEventListener("change",I),e('select[name="as-checkinTime"]').addEventListener("change",I),t("input[type=date").forEach((e=>e.addEventListener("change",v))),t("#charts-container").forEach((e=>{new i(e)})),document.addEventListener("keydown",y),t("a.quicksearch").forEach((e=>e.addEventListener("click",g)))}log.level=log[(te=window.location.hostname,"localhost"===te?"INFO":"ERROR")];export{ee as collectionCodeAc,V as getCollectionCodes,Q as getJournalTitles,F as hideTooltip,ne as init,X as journalTitleAc,H as showTooltip};
