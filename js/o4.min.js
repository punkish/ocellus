/*! lazysizes - v5.1.2 */
!function(e,t){var n=function(e,t){"use strict";var n,a;if(function(){var t,n={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(t in a=e.lazySizesConfig||e.lazysizesConfig||{},n)t in a||(a[t]=n[t])}(),!t||!t.getElementsByClassName)return{init:function(){},cfg:a,noSupport:!0};var i=t.documentElement,r=e.Date,s=e.HTMLPictureElement,o="addEventListener",l="getAttribute",c=e[o],u=e.setTimeout,d=e.requestAnimationFrame||u,f=e.requestIdleCallback,m=/^picture$/i,y=["load","error","lazyincluded","_lazyloaded"],z={},h=Array.prototype.forEach,v=function(e,t){return z[t]||(z[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),z[t].test(e[l]("class")||"")&&z[t]},g=function(e,t){v(e,t)||e.setAttribute("class",(e[l]("class")||"").trim()+" "+t)},p=function(e,t){var n;(n=v(e,t))&&e.setAttribute("class",(e[l]("class")||"").replace(n," "))},C=function(e,t,n){var a=n?o:"removeEventListener";n&&C(e,t),y.forEach((function(n){e[a](n,t)}))},b=function(e,a,i,r,s){var o=t.createEvent("Event");return i||(i={}),i.instance=n,o.initEvent(a,!r,!s),o.detail=i,e.dispatchEvent(o),o},A=function(t,n){var i;!s&&(i=e.picturefill||a.pf)?(n&&n.src&&!t[l]("srcset")&&t.setAttribute("srcset",n.src),i({reevaluate:!0,elements:[t]})):n&&n.src&&(t.src=n.src)},E=function(e,t){return(getComputedStyle(e,null)||{})[t]},_=function(e,t,n){for(n=n||e.offsetWidth;n<a.minSize&&t&&!e._lazysizesWidth;)n=t.offsetWidth,t=t.parentNode;return n},w=function(){var e,n,a=[],i=[],r=a,s=function(){var t=r;for(r=a.length?i:a,e=!0,n=!1;t.length;)t.shift()();e=!1},o=function(a,i){e&&!i?a.apply(this,arguments):(r.push(a),n||(n=!0,(t.hidden?u:d)(s)))};return o._lsFlush=s,o}(),N=function(e,t){return t?function(){w(e)}:function(){var t=this,n=arguments;w((function(){e.apply(t,n)}))}},M=function(e){var t,n=0,i=a.throttleDelay,s=a.ricTimeout,o=function(){t=!1,n=r.now(),e()},l=f&&s>49?function(){f(o,{timeout:s}),s!==a.ricTimeout&&(s=a.ricTimeout)}:N((function(){u(o)}),!0);return function(e){var a;(e=!0===e)&&(s=33),t||(t=!0,(a=i-(r.now()-n))<0&&(a=0),e||a<9?l():u(l,a))}},x=function(e){var t,n,a=99,i=function(){t=null,e()},s=function(){var e=r.now()-n;e<a?u(s,a-e):(f||i)(i)};return function(){n=r.now(),t||(t=u(s,a))}},W=function(){var s,d,f,y,z,_,W,L,S,T,F,R,D=/^img$/i,k=/^iframe$/i,H="onscroll"in e&&!/(gle|ing)bot/.test(navigator.userAgent),O=0,P=0,$=0,I=-1,q=function(e){$--,(!e||$<0||!e.target)&&($=0)},U=function(e){return null==R&&(R="hidden"==E(t.body,"visibility")),R||!("hidden"==E(e.parentNode,"visibility")&&"hidden"==E(e,"visibility"))},j=function(e,n){var a,r=e,s=U(e);for(L-=n,F+=n,S-=n,T+=n;s&&(r=r.offsetParent)&&r!=t.body&&r!=i;)(s=(E(r,"opacity")||1)>0)&&"visible"!=E(r,"overflow")&&(a=r.getBoundingClientRect(),s=T>a.left&&S<a.right&&F>a.top-1&&L<a.bottom+1);return s},G=function(){var e,r,o,c,u,f,m,z,h,v,g,p,C=n.elements;if((y=a.loadMode)&&$<8&&(e=C.length)){for(r=0,I++;r<e;r++)if(C[r]&&!C[r]._lazyRace)if(!H||n.prematureUnveil&&n.prematureUnveil(C[r]))ee(C[r]);else if((z=C[r][l]("data-expand"))&&(f=1*z)||(f=P),v||(v=!a.expand||a.expand<1?i.clientHeight>500&&i.clientWidth>500?500:370:a.expand,n._defEx=v,g=v*a.expFactor,p=a.hFac,R=null,P<g&&$<1&&I>2&&y>2&&!t.hidden?(P=g,I=0):P=y>1&&I>1&&$<6?v:O),h!==f&&(_=innerWidth+f*p,W=innerHeight+f,m=-1*f,h=f),o=C[r].getBoundingClientRect(),(F=o.bottom)>=m&&(L=o.top)<=W&&(T=o.right)>=m*p&&(S=o.left)<=_&&(F||T||S||L)&&(a.loadHidden||U(C[r]))&&(d&&$<3&&!z&&(y<3||I<4)||j(C[r],f))){if(ee(C[r]),u=!0,$>9)break}else!u&&d&&!c&&$<4&&I<4&&y>2&&(s[0]||a.preloadAfterLoad)&&(s[0]||!z&&(F||T||S||L||"auto"!=C[r][l](a.sizesAttr)))&&(c=s[0]||C[r]);c&&!u&&ee(c)}},J=M(G),K=function(e){var t=e.target;t._lazyCache?delete t._lazyCache:(q(e),g(t,a.loadedClass),p(t,a.loadingClass),C(t,V),b(t,"lazyloaded"))},Q=N(K),V=function(e){Q({target:e.target})},X=function(e,t){try{e.contentWindow.location.replace(t)}catch(n){e.src=t}},Y=function(e){var t,n=e[l](a.srcsetAttr);(t=a.customMedia[e[l]("data-media")||e[l]("media")])&&e.setAttribute("media",t),n&&e.setAttribute("srcset",n)},Z=N((function(e,t,n,i,r){var s,o,c,d,y,z;(y=b(e,"lazybeforeunveil",t)).defaultPrevented||(i&&(n?g(e,a.autosizesClass):e.setAttribute("sizes",i)),o=e[l](a.srcsetAttr),s=e[l](a.srcAttr),r&&(d=(c=e.parentNode)&&m.test(c.nodeName||"")),z=t.firesLoad||"src"in e&&(o||s||d),y={target:e},g(e,a.loadingClass),z&&(clearTimeout(f),f=u(q,2500),C(e,V,!0)),d&&h.call(c.getElementsByTagName("source"),Y),o?e.setAttribute("srcset",o):s&&!d&&(k.test(e.nodeName)?X(e,s):e.src=s),r&&(o||d)&&A(e,{src:s})),e._lazyRace&&delete e._lazyRace,p(e,a.lazyClass),w((function(){var t=e.complete&&e.naturalWidth>1;z&&!t||(t&&g(e,"ls-is-cached"),K(y),e._lazyCache=!0,u((function(){"_lazyCache"in e&&delete e._lazyCache}),9)),"lazy"==e.loading&&$--}),!0)})),ee=function(e){if(!e._lazyRace){var t,n=D.test(e.nodeName),i=n&&(e[l](a.sizesAttr)||e[l]("sizes")),r="auto"==i;(!r&&d||!n||!e[l]("src")&&!e.srcset||e.complete||v(e,a.errorClass)||!v(e,a.lazyClass))&&(t=b(e,"lazyunveilread").detail,r&&B.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,$++,Z(e,t,r,i,n))}},te=x((function(){a.loadMode=3,J()})),ne=function(){3==a.loadMode&&(a.loadMode=2),te()},ae=function(){if(!d){if(r.now()-z<999)return void u(ae,999);d=!0,a.loadMode=3,J(),c("scroll",ne,!0)}};return{_:function(){z=r.now(),n.elements=t.getElementsByClassName(a.lazyClass),s=t.getElementsByClassName(a.lazyClass+" "+a.preloadClass),c("scroll",J,!0),c("resize",J,!0),e.MutationObserver?new MutationObserver(J).observe(i,{childList:!0,subtree:!0,attributes:!0}):(i[o]("DOMNodeInserted",J,!0),i[o]("DOMAttrModified",J,!0),setInterval(J,999)),c("hashchange",J,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach((function(e){t[o](e,J,!0)})),/d$|^c/.test(t.readyState)?ae():(c("load",ae),t[o]("DOMContentLoaded",J),u(ae,2e4)),n.elements.length?(G(),w._lsFlush()):J()},checkElems:J,unveil:ee,_aLSL:ne}}(),B=function(){var e,n=N((function(e,t,n,a){var i,r,s;if(e._lazysizesWidth=a,a+="px",e.setAttribute("sizes",a),m.test(t.nodeName||""))for(r=0,s=(i=t.getElementsByTagName("source")).length;r<s;r++)i[r].setAttribute("sizes",a);n.detail.dataAttr||A(e,n.detail)})),i=function(e,t,a){var i,r=e.parentNode;r&&(a=_(e,r,a),(i=b(e,"lazybeforesizes",{width:a,dataAttr:!!t})).defaultPrevented||(a=i.detail.width)&&a!==e._lazysizesWidth&&n(e,r,i,a))},r=x((function(){var t,n=e.length;if(n)for(t=0;t<n;t++)i(e[t])}));return{_:function(){e=t.getElementsByClassName(a.autosizesClass),c("resize",r)},checkElems:r,updateElem:i}}(),L=function(){!L.i&&t.getElementsByClassName&&(L.i=!0,B._(),W._())};return u((function(){a.init&&L()})),n={cfg:a,autoSizer:B,loader:W,init:L,uP:A,aC:g,rC:p,hC:v,fire:b,gW:_,rAF:w}}(e,e.document);e.lazySizes=n,"object"==typeof module&&module.exports&&(module.exports=n)}("undefined"!=typeof window?window:{});
!function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,(function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var a=/\S/;function u(e){return!function(e,t){return s.call(e,t)}(a,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var p=/\s*/,l=/\s+/,h=/\s*=/,f=/\s*\}/,d=/#|\^|\/|>|\{|&|=|!/;function v(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function w(){this.cache={}}v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var i,s,a=this,u=!1;a;){if(e.indexOf(".")>0)for(t=a.view,i=e.split("."),s=0;null!=t&&s<i.length;)s===i.length-1&&(u=o(t,i[s])),t=t[i[s++]];else t=a.view[e],u=o(a.view,e);if(u)break;a=a.parent}n[e]=t}return r(t)&&(t=t.call(this.view)),t},w.prototype.clearCache=function(){this.cache={}},w.prototype.parse=function(t,r){var o=this.cache,s=o[t];return null==s&&(s=o[t]=function(t,r){if(!t)return[];var o,s,a,c=[],g=[],w=[],y=!1,x=!1;function k(){if(y&&!x)for(;w.length;)delete g[w.pop()];else w=[];y=!1,x=!1}function b(e){if("string"==typeof e&&(e=e.split(l,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);o=new RegExp(i(e[0])+"\\s*"),s=new RegExp("\\s*"+i(e[1])),a=new RegExp("\\s*"+i("}"+e[1]))}b(r||e.tags);for(var m,E,U,T,j,S,V=new v(t);!V.eos();){if(m=V.pos,U=V.scanUntil(o))for(var C=0,A=U.length;C<A;++C)u(T=U.charAt(C))?w.push(g.length):x=!0,g.push(["text",T,m,m+1]),m+=1,"\n"===T&&k();if(!V.scan(o))break;if(y=!0,E=V.scan(d)||"name",V.scan(p),"="===E?(U=V.scanUntil(h),V.scan(h),V.scanUntil(s)):"{"===E?(U=V.scanUntil(a),V.scan(f),V.scanUntil(s),E="&"):U=V.scanUntil(s),!V.scan(s))throw new Error("Unclosed tag at "+V.pos);if(j=[E,U,m,V.pos],g.push(j),"#"===E||"^"===E)c.push(j);else if("/"===E){if(!(S=c.pop()))throw new Error('Unopened section "'+U+'" at '+m);if(S[1]!==U)throw new Error('Unclosed section "'+S[1]+'" at '+m)}else"name"===E||"{"===E||"&"===E?x=!0:"="===E&&b(U)}if(S=c.pop())throw new Error('Unclosed section "'+S[1]+'" at '+V.pos);return function(e){for(var t,n=[],r=n,i=[],o=0,s=e.length;o<s;++o)switch((t=e[o])[0]){case"#":case"^":r.push(t),i.push(t),r=t[4]=[];break;case"/":i.pop()[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],i=0,o=e.length;i<o;++i)(t=e[i])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(g))}(t,r)),s},w.prototype.render=function(e,t,n){var r=this.parse(e),i=t instanceof g?t:new g(t);return this.renderTokens(r,i,n,e)},w.prototype.renderTokens=function(e,t,n,r){for(var i,o,s,a="",u=0,c=e.length;u<c;++u)s=void 0,"#"===(o=(i=e[u])[0])?s=this.renderSection(i,t,n,r):"^"===o?s=this.renderInverted(i,t,n,r):">"===o?s=this.renderPartial(i,t,n,r):"&"===o?s=this.unescapedValue(i,t):"name"===o?s=this.escapedValue(i,t):"text"===o&&(s=this.rawValue(i)),void 0!==s&&(a+=s);return a},w.prototype.renderSection=function(e,t,i,o){var s=this,a="",u=t.lookup(e[1]);if(u){if(n(u))for(var c=0,p=u.length;c<p;++c)a+=this.renderTokens(e[4],t.push(u[c]),i,o);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],t.push(u),i,o);else if(r(u)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(u=u.call(t.view,o.slice(e[3],e[5]),(function(e){return s.render(e,t,i)})))&&(a+=u)}else a+=this.renderTokens(e[4],t,i,o);return a}},w.prototype.renderInverted=function(e,t,r,i){var o=t.lookup(e[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(e[4],t,r,i)},w.prototype.renderPartial=function(e,t,n){if(n){var i=r(n)?n(e[1]):n[e[1]];return null!=i?this.renderTokens(this.parse(i),t,n,i):void 0}},w.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},w.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},w.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var y=new w;return e.clearCache=function(){return y.clearCache()},e.parse=function(e,t){return y.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+((n(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)'));var i;return y.render(e,t,r)},e.to_html=function(t,n,i,o){var s=e.render(t,n,i);if(!r(o))return s;o(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=v,e.Context=g,e.Writer=w,e}));
var autoComplete=function(e){function t(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function s(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function l(e,s,l,n){o(n||document,s,(function(o){for(var s,n=o.target||o.srcElement;n&&!(s=t(n,e));)n=n.parentElement;s&&l.call(n,o)}))}if(document.querySelector){var n={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(){}};for(var c in e)e.hasOwnProperty(c)&&(n[c]=e[c]);for(var a="object"==typeof n.selector?[n.selector]:document.querySelectorAll(n.selector),u=0;u<a.length;u++){var i=a[u];i.sc=document.createElement("div"),i.sc.className="autocomplete-suggestions "+n.menuClass,i.autocompleteAttr=i.getAttribute("autocomplete"),i.setAttribute("autocomplete","off"),i.cache={},i.last_val="",i.updateSC=function(e,t){var o=i.getBoundingClientRect();if(i.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+n.offsetLeft)+"px",i.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+n.offsetTop)+"px",i.sc.style.width=Math.round(o.right-o.left)+"px",!e&&(i.sc.style.display="block",i.sc.maxHeight||(i.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(i.sc,null):i.sc.currentStyle).maxHeight)),i.sc.suggestionHeight||(i.sc.suggestionHeight=i.sc.querySelector(".autocomplete-suggestion").offsetHeight),i.sc.suggestionHeight))if(t){var s=i.sc.scrollTop,l=t.getBoundingClientRect().top-i.sc.getBoundingClientRect().top;l+i.sc.suggestionHeight-i.sc.maxHeight>0?i.sc.scrollTop=l+i.sc.suggestionHeight+s-i.sc.maxHeight:0>l&&(i.sc.scrollTop=l+s)}else i.sc.scrollTop=0},o(window,"resize",i.updateSC),document.body.appendChild(i.sc),l("autocomplete-suggestion","mouseleave",(function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&setTimeout((function(){e.className=e.className.replace("selected","")}),20)}),i.sc),l("autocomplete-suggestion","mouseover",(function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&(e.className=e.className.replace("selected","")),this.className+=" selected"}),i.sc),l("autocomplete-suggestion","mousedown",(function(e){if(t(this,"autocomplete-suggestion")){var o=this.getAttribute("data-val");i.value=o,n.onSelect(e,o,this),i.sc.style.display="none"}}),i.sc),i.blurHandler=function(){try{var e=document.querySelector(".autocomplete-suggestions:hover")}catch(t){e=0}e?i!==document.activeElement&&setTimeout((function(){i.focus()}),20):(i.last_val=i.value,i.sc.style.display="none",setTimeout((function(){i.sc.style.display="none"}),350))},o(i,"blur",i.blurHandler);var r=function(e){var t=i.value;if(i.cache[t]=e,e.length&&t.length>=n.minChars){for(var o="",s=0;s<e.length;s++)o+=n.renderItem(e[s],t);i.sc.innerHTML=o,i.updateSC(0)}else i.sc.style.display="none"};i.keydownHandler=function(e){var t,o=window.event?e.keyCode:e.which;if((40==o||38==o)&&i.sc.innerHTML)return(s=i.sc.querySelector(".autocomplete-suggestion.selected"))?(t=40==o?s.nextSibling:s.previousSibling)?(s.className=s.className.replace("selected",""),t.className+=" selected",i.value=t.getAttribute("data-val")):(s.className=s.className.replace("selected",""),i.value=i.last_val,t=0):((t=40==o?i.sc.querySelector(".autocomplete-suggestion"):i.sc.childNodes[i.sc.childNodes.length-1]).className+=" selected",i.value=t.getAttribute("data-val")),i.updateSC(0,t),!1;if(27==o)i.value=i.last_val,i.sc.style.display="none";else if(13==o||9==o){var s;(s=i.sc.querySelector(".autocomplete-suggestion.selected"))&&"none"!=i.sc.style.display&&(n.onSelect(e,s.getAttribute("data-val"),s),setTimeout((function(){i.sc.style.display="none"}),20))}},o(i,"keydown",i.keydownHandler),i.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(35>t||t>40)&&13!=t&&27!=t){var o=i.value;if(o.length>=n.minChars){if(o!=i.last_val){if(i.last_val=o,clearTimeout(i.timer),n.cache){if(o in i.cache)return void r(i.cache[o]);for(var s=1;s<o.length-n.minChars;s++){var l=o.slice(0,o.length-s);if(l in i.cache&&!i.cache[l].length)return void r([])}}i.timer=setTimeout((function(){n.source(o,r)}),n.delay)}}else i.last_val=o,i.sc.style.display="none"}},o(i,"keyup",i.keyupHandler),i.focusHandler=function(e){i.last_val="\n",i.keyupHandler(e)},n.minChars||o(i,"focus",i.focusHandler)}this.destroy=function(){for(var e=0;e<a.length;e++){var t=a[e];s(window,"resize",t.updateSC),s(t,"blur",t.blurHandler),s(t,"focus",t.focusHandler),s(t,"keydown",t.keydownHandler),s(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}};"function"==typeof define&&define.amd?define("autoComplete",(function(){return autoComplete})):"undefined"!=typeof module&&module.exports?module.exports=autoComplete:window.autoComplete=autoComplete;
"undefined"!=typeof O&&"object"==typeof O||(O={}),O.base={"num-of-records":{images:0,treatments:0,citations:0},logger:function(e,o){const s="-".repeat(50);log.info(s),log.info(`${e}: ${o}`),log.info(s)},init:function(){log.level=log[G.loglevel],log.info("the log level is "+G.loglevel),O.base.addEventHandlers([{selectors:document.querySelectorAll(".modal-open"),action:"click",handler:{name:"openModal()",fn:O.openModal}},{selectors:document.querySelectorAll(".modal-close"),action:"click",handler:{name:"closeModal()",fn:O.closeModal}}]);const{hash:e,resource:o,search:s}=O.base.resourceFromUrl(location);O.closedForMaintenance?G.pseudoResources.includes(o)?O.base.show(o):O.base.show("closedForMaintenance"):(O.base.addEventHandlers([{selectors:[document.querySelector("#searcher")],action:"submit",handler:{name:"prepareQuery()",fn:O.utils.prepareQuery}},{selectors:[document.querySelector("input[name=submit]")],action:"click",handler:{name:"prepareQuery()",fn:O.utils.prepareQuery}},{selectors:document.querySelectorAll("input[name=resource]"),action:"click",handler:{name:"selectResource()",fn:O.base.selectResource}},{selectors:[document.querySelector('input[name="refreshCache"]'),document.querySelector("input[name=communitiesChooser]")],action:"click",handler:{name:"toggler()",fn:O.base.toggler}}]),G.pseudoResources.includes(o)?O.base.show(o):(O.base.show("searcher"),O.base.logger("init()","initializing autocomplete"),new autoComplete({selector:document.querySelector("input[name=q]"),minChars:3,source:async function(e,o){try{fetch.abort()}catch(e){}let s=await fetch(`${G.zenodeoUri}/families?q=${e}`);if(s.ok){const e=await s.json();if(e.item.result.count){o(e.item.result.records.map((e=>e.family)))}}else alert("HTTP-Error: "+s.status)}}),log.info("- getting "+o),"index"===o?(log.info("- getting selected resource"),O.base.updatePlaceholder(document.querySelector("input[name=resource]:checked").value),O.base.show("index")):G.resources.includes(o)&&(s?(log.info("- getting search"),O.base.fillSearchForm(s,o)):(log.info("- getting "+o),O.base._selectResource(o),O.base.updatePlaceholder(o),O.base.show(o)))))},addEventHandlers:function(e){O.base.logger("addEventHandlers()","adding event handlers");for(let o=0,s=e.length;o<s;o++){const{selectors:s,action:t,handler:n}=e[o];for(let e=0,o=s.length;e<o;e++){const o=s[e],r=o.name||o.id||`${o.nodeName}.${o.pathname.split("/").pop()}`;log.info(`- added ${n.name} to ${r}`),o.addEventListener(t,n.fn)}}},toggler:function(e){const o=e.target.name,s=document.getElementById(""+o);s.classList.contains("hidden-none")?(s.classList.add("visible-block"),s.classList.remove("hidden-none")):s.classList.contains("hidden-block")?(s.classList.add("visible-block"),s.classList.remove("hidden-block")):s.classList.contains("visible-block")&&(s.classList.add("hidden-block"),s.classList.remove("visible-block"))},openModal:function(e){const o=document.querySelectorAll("main section");for(let e=0,s=o.length;e<s;e++)O.base.hide(o[e].id);const s=e.target.href.split("/").pop().split(".").shift(),t=s+".html";history.pushState(null,null,t),O.base.show(s),e.stopPropagation(),e.preventDefault()},closeModal:function(e){let o=e.target.parentElement.id;O.base.hide(o),O.closedForMaintenance?o="closedForMaintenance":(o="index",O.base.show("searcher"));const s=O.closedForMaintenance?"index.html":o+".html";history.pushState(null,null,s),O.base.show(o),e.stopPropagation(),e.preventDefault()},show:function(e){log.info("showing "+e);const o=document.querySelector("#"+e);o.classList.add("visible-block"),o.classList.remove("hidden-none")},hide:function(e){log.info("hiding "+e);const o=document.querySelector("#"+e);o.classList.add("hidden-none"),o.classList.remove("visible-block")},formatSearchCriteria:function(e){const o=[];for(let s in e)if(!G.notInSearchCriteria.includes(s)){const t=e[s];"q"===s?32===e[s].length?"treatments"===e.resource?o.push(`<span class="crit-key">treatmentId</span> is <span class="crit-val">${t}</span>`):"citations"===e.resource&&o.push(`<span class="crit-key">bibRefCitationId</span> is <span class="crit-val">${t}</span>`):o.push(`<span class="crit-val">${t}</span> is in the text`):o.push(`<span class="crit-key">${s}</span> is <span class="crit-val">${t}</span>`)}let s=o.length,t="";return 1===s?t+=o[0]:2===s?t+=o.join(" and "):s>2&&(s-=1,t+=o.slice(0,s).join(", ")+", and "+o[s]),t},toggleFigcaption:function(e){const o=document.querySelectorAll("figcaption");for(let e=0,s=o.length;e<s;e++)o[e].style.maxHeight=G.closedFigcaptionHeight,o[e].style.overflow="hidden";const s=this.parentElement;s.style.maxHeight="100%",s.style.overflow="auto"},resourceFromUrl:function(e){const{hash:o,pathname:s,search:t}=e;O.base.logger("resourceFromUri()",e);let n=s.split("/").pop().split(".")[0];return""!==n&&"dev"!==n||(n="index"),log.info("- hash: "+o),log.info("- resource: "+n),log.info("- search: "+t),{hash:o,resource:n,search:t}},resourceFromForm:function(e){return document.querySelector("input[name=resource]:checked").value},resourceFromModalClick:function(e){const o=e.target.href;if(O.logger("resourceFromUri()",loc),log.info("- href: "+o),o)return o.split("/").pop().split(".").shift()},_selectResource:function(e){const o=document.querySelectorAll("#resourceChooser label"),s=document.querySelectorAll("#resourceChooser input");for(let t=0,n=o.length;t<n;t++)s[t].value===e?(s[t].checked=!0,o[t].classList.add("searchfocus")):(s[t].checked=!1,o[t].classList.remove("searchfocus"))},selectResource:function(e){const o=e.target.value;log.info("selected resource "+o),O.base._selectResource(o),O.base.updatePlaceholder(o)},updatePlaceholder:function(e){O.base.logger("updatePlaceholder()","updating placeholder"),O.base["num-of-records"][e]?O.base.setPlaceHolder({"num-of-records":O.base["num-of-records"][e],resource:e}):O.utils.getResource({resource:e,inputs:null,cb:O.base.setPlaceHolder})},setPlaceHolder:function(e){0==O.base["num-of-records"][e.resource]&&(O.base["num-of-records"][e.resource]=e["num-of-records"]);const o=`search ${e["num-of-records"]} ${e.resource}`;log.info(`placeholder: "${o}"`);const s=document.querySelector("input[name=q]");s.placeholder=o,s.focus()},fetchReceive:function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status);return e.json()},hls:function(e){const o=document.querySelectorAll("input[name=resource");for(let s=0,t=o.length;s<t;s++){const t=o[s],n=t.parentElement;t.value===e?(log.info(`setting checked of ${t.value} to true`),t.checked=!0,n.classList.add("searchfocus")):(t.checked=!1,n.classList.remove("searchfocus"))}},fillSearchForm:function(e,o){O.base.logger("fillSearchForm()","filling search form"),log.info("- search: "+e),log.info("- resource: "+o);const s=document.querySelector("#searcher"),t=new URLSearchParams(e);for(const[e,o]of t)if(G.validQueryParams.includes(e)){const t=s.querySelectorAll(`input[name="${e}"]`);for(let e=0,s=t.length;e<s;e++){const s=t[e];"checkbox"===s.type?s.value===o&&(log.info(`setting checked of ${s.name} with value ${s.value} to 'true'`),s.checked=!0):s.value=o}}O.base.hls(o),O.utils.prepareQuery()}};
"undefined"!=typeof O&&"object"==typeof O||(O={}),O.utils={niceNumbers:function(e){return e>9?e:["No","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"][e]},renderResults:function(e){const t=e.resource,n=e.template,r=document.querySelector(`#${t} div.result`),s=document.querySelector("#template-"+n).innerHTML,o={"template-pager":document.querySelector("#template-pager").innerHTML,"template-records-found":document.querySelector("#template-records-found").innerHTML,"template-kein-preview":document.querySelector("#template-kein-preview").innerHTML};r.innerHTML=Mustache.render(s,e,o);const i=document.querySelectorAll("figcaption > a");for(let e=0,t=i.length;e<t;e++)i[e].addEventListener("click",O.base.toggleFigcaption);return e.resource},prepareQuery:function(e){e&&(e.stopPropagation(),e.preventDefault());const t=document.querySelector("#searcher"),n=t.elements,r=t.querySelector("input[name=q]");if(""===r.value)return r.placeholder="câ€˜mon, enter something",r.classList.remove("nudge"),r.classList.add("warning"),r.focus(),!1;r.classList.remove("warning"),r.classList.add("nudge");const s={};for(let e=0,r=n.length;e<r;e++){const n=t[e];if(n.name){const e=n.name,t=n.value,r=n.type,o=n.checked;"checkbox"===r?o&&(e in s?s[e].push(t):s[e]=[t]):"radio"===r?o&&(s[e]=t):s[e]=t}}O.utils.getResource({resource:document.querySelector("input[name=resource]:checked").value,inputs:s,cb:O.utils.renderResults})},noThrob:function(e){const t=document.querySelectorAll("main section");for(let n=0,r=t.length;n<r;n++){const r=t[n].id;r!==e&&O.base.hide(r)}document.querySelector("#throbber").classList.add("nothrob")},getResource:function(e){const{resource:t,inputs:n,cb:r}=e,{z:s,b:o}=O.utils.inputs2uris(n,t);O.base.logger("getResource()","getting "+t),log.info("zenodeoUri: "+s),log.info("browserUri: "+o);let i;document.querySelector("#throbber").classList.remove("nothrob"),n&&(i=n?O.base.formatSearchCriteria(n):"",O.utils.waitMessage(t,i),history.pushState(null,null,o),O.base.show(t));try{fetch(s).then(O.base.fetchReceive).then((function(e){const r=e.item.result,s={resource:t,"num-of-records":r.count};if(n)if(s["search-criteria-text"]=i,32===n.q.length)"treatments"===r["search-criteria"].resource?s.template="treatment":"citations"===r["search-criteria"].resource&&(s.template="citation"),r.count&&(s.figures=r.records[0]);else if(s.template=s.resource,s.niceNumbers=O.utils.niceNumbers(r.count),r.count){if(s.successful=!0,1==r.count)s.shown="it is shown below";else if(r.count>1&&r.count<=G.pageSize)s.shown=`one to ${s.niceNumbers} are shown below`;else{const e=O.utils.niceNumbers((n.page-1)*G.pageSize+1),t=O.utils.niceNumbers(n.page*G.pageSize);s.shown=`${e} to ${t} are shown below`}if(s.figures=function(e,t){let n=[];if("treatments"===e)for(let e=0,r=t.length;e<r;e++){const r=t[e];r.recId=r.treatmentId,n.push(r)}else if("images"===e)for(let e=0,r=t.length;e<r;e++){const r=t[e];n.push({title:r.metadata.title,creators:r.metadata.creators?r.metadata.creators.map((e=>e.name)):[],recId:r.id,zenodoRecord:`${G.zenodoUri}/${r.id}`,description:r.metadata.description,doi:r.doi,img:!!r.links.thumbs,img10:r.links.thumbs?r.links.thumbs[10]:"",img50:r.links.thumbs?r.links.thumbs[50]:"",img100:r.links.thumbs?r.links.thumbs[100]:"",img250:r.links.thumbs?r.links.thumbs[250]:"",img750:r.links.thumbs?r.links.thumbs[750]:"",img1200:r.links.thumbs?r.links.thumbs[1200]:""})}else if("citations"===e)for(let e=0,r=t.length;e<r;e++){const r=t[e];r.recId=r.bibRefCitationId,n.push(r)}return n}(t,r.records),r.count>=G.pageSize){const t=new URL(e.item._links._prev),n=new URL(e.item._links._next);s.prev=t.search,s.next=n.search,s.pager=!0}}else s.successful=!1,s.shown="",s.pager=!1,s.figures=[];return s})).then(r).then(O.utils.noThrob)}catch(e){log.error(e)}},waitMessage:function(e,t){const n=document.querySelector("#"+e);O.base.show(e);n.querySelector(".result").innerHTML=`<p id="records-found" class="records-found">Looking for ${e} where ${t}</p>`},inputs2uris:function(e,t){const n=[],r=[];for(const s in e)G.zenodeoUriParams[t].includes(s)&&("q"===s?32==s.length?"treaments"===t?n.push("treatmentId="+e[s]):"citations"===t&&n.push("bibRefCitationId="+e[s]):n.push("q="+e[s]):n.push(`${s}=${e[s]}`)),G.browserUriParams[t].includes(s)&&r.push(`${s}=${e[s]}`);const s=n.length?"?"+n.sort().join("&"):"";return{z:`${G.zenodeoUri}/${t}${s}`,b:`${t}.html${r.length?"?"+r.join("&"):""}`}}};