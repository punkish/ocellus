/*! lazysizes - v5.1.2 */
!function(e,t){var n=function(e,t){"use strict";var n,a;if(function(){var t,n={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(t in a=e.lazySizesConfig||e.lazysizesConfig||{},n)t in a||(a[t]=n[t])}(),!t||!t.getElementsByClassName)return{init:function(){},cfg:a,noSupport:!0};var i=t.documentElement,r=e.Date,s=e.HTMLPictureElement,o="addEventListener",l="getAttribute",c=e[o],u=e.setTimeout,d=e.requestAnimationFrame||u,f=e.requestIdleCallback,m=/^picture$/i,y=["load","error","lazyincluded","_lazyloaded"],z={},h=Array.prototype.forEach,v=function(e,t){return z[t]||(z[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),z[t].test(e[l]("class")||"")&&z[t]},g=function(e,t){v(e,t)||e.setAttribute("class",(e[l]("class")||"").trim()+" "+t)},p=function(e,t){var n;(n=v(e,t))&&e.setAttribute("class",(e[l]("class")||"").replace(n," "))},C=function(e,t,n){var a=n?o:"removeEventListener";n&&C(e,t),y.forEach((function(n){e[a](n,t)}))},b=function(e,a,i,r,s){var o=t.createEvent("Event");return i||(i={}),i.instance=n,o.initEvent(a,!r,!s),o.detail=i,e.dispatchEvent(o),o},A=function(t,n){var i;!s&&(i=e.picturefill||a.pf)?(n&&n.src&&!t[l]("srcset")&&t.setAttribute("srcset",n.src),i({reevaluate:!0,elements:[t]})):n&&n.src&&(t.src=n.src)},E=function(e,t){return(getComputedStyle(e,null)||{})[t]},_=function(e,t,n){for(n=n||e.offsetWidth;n<a.minSize&&t&&!e._lazysizesWidth;)n=t.offsetWidth,t=t.parentNode;return n},w=function(){var e,n,a=[],i=[],r=a,s=function(){var t=r;for(r=a.length?i:a,e=!0,n=!1;t.length;)t.shift()();e=!1},o=function(a,i){e&&!i?a.apply(this,arguments):(r.push(a),n||(n=!0,(t.hidden?u:d)(s)))};return o._lsFlush=s,o}(),N=function(e,t){return t?function(){w(e)}:function(){var t=this,n=arguments;w((function(){e.apply(t,n)}))}},M=function(e){var t,n=0,i=a.throttleDelay,s=a.ricTimeout,o=function(){t=!1,n=r.now(),e()},l=f&&s>49?function(){f(o,{timeout:s}),s!==a.ricTimeout&&(s=a.ricTimeout)}:N((function(){u(o)}),!0);return function(e){var a;(e=!0===e)&&(s=33),t||(t=!0,(a=i-(r.now()-n))<0&&(a=0),e||a<9?l():u(l,a))}},x=function(e){var t,n,a=function(){t=null,e()},i=function(){var e=r.now()-n;e<99?u(i,99-e):(f||a)(a)};return function(){n=r.now(),t||(t=u(i,99))}},W=function(){var s,d,f,y,z,_,W,L,S,T,F,R,D=/^img$/i,k=/^iframe$/i,H="onscroll"in e&&!/(gle|ing)bot/.test(navigator.userAgent),O=0,P=0,$=-1,I=function(e){P--,(!e||P<0||!e.target)&&(P=0)},q=function(e){return null==R&&(R="hidden"==E(t.body,"visibility")),R||!("hidden"==E(e.parentNode,"visibility")&&"hidden"==E(e,"visibility"))},U=function(e,n){var a,r=e,s=q(e);for(L-=n,F+=n,S-=n,T+=n;s&&(r=r.offsetParent)&&r!=t.body&&r!=i;)(s=(E(r,"opacity")||1)>0)&&"visible"!=E(r,"overflow")&&(a=r.getBoundingClientRect(),s=T>a.left&&S<a.right&&F>a.top-1&&L<a.bottom+1);return s},j=function(){var e,r,o,c,u,f,m,z,h,v,g,p,C=n.elements;if((y=a.loadMode)&&P<8&&(e=C.length)){for(r=0,$++;r<e;r++)if(C[r]&&!C[r]._lazyRace)if(!H||n.prematureUnveil&&n.prematureUnveil(C[r]))Y(C[r]);else if((z=C[r][l]("data-expand"))&&(f=1*z)||(f=O),v||(v=!a.expand||a.expand<1?i.clientHeight>500&&i.clientWidth>500?500:370:a.expand,n._defEx=v,g=v*a.expFactor,p=a.hFac,R=null,O<g&&P<1&&$>2&&y>2&&!t.hidden?(O=g,$=0):O=y>1&&$>1&&P<6?v:0),h!==f&&(_=innerWidth+f*p,W=innerHeight+f,m=-1*f,h=f),o=C[r].getBoundingClientRect(),(F=o.bottom)>=m&&(L=o.top)<=W&&(T=o.right)>=m*p&&(S=o.left)<=_&&(F||T||S||L)&&(a.loadHidden||q(C[r]))&&(d&&P<3&&!z&&(y<3||$<4)||U(C[r],f))){if(Y(C[r]),u=!0,P>9)break}else!u&&d&&!c&&P<4&&$<4&&y>2&&(s[0]||a.preloadAfterLoad)&&(s[0]||!z&&(F||T||S||L||"auto"!=C[r][l](a.sizesAttr)))&&(c=s[0]||C[r]);c&&!u&&Y(c)}},G=M(j),J=function(e){var t=e.target;t._lazyCache?delete t._lazyCache:(I(e),g(t,a.loadedClass),p(t,a.loadingClass),C(t,Q),b(t,"lazyloaded"))},K=N(J),Q=function(e){K({target:e.target})},V=function(e){var t,n=e[l](a.srcsetAttr);(t=a.customMedia[e[l]("data-media")||e[l]("media")])&&e.setAttribute("media",t),n&&e.setAttribute("srcset",n)},X=N((function(e,t,n,i,r){var s,o,c,d,y,z;(y=b(e,"lazybeforeunveil",t)).defaultPrevented||(i&&(n?g(e,a.autosizesClass):e.setAttribute("sizes",i)),o=e[l](a.srcsetAttr),s=e[l](a.srcAttr),r&&(d=(c=e.parentNode)&&m.test(c.nodeName||"")),z=t.firesLoad||"src"in e&&(o||s||d),y={target:e},g(e,a.loadingClass),z&&(clearTimeout(f),f=u(I,2500),C(e,Q,!0)),d&&h.call(c.getElementsByTagName("source"),V),o?e.setAttribute("srcset",o):s&&!d&&(k.test(e.nodeName)?function(e,t){try{e.contentWindow.location.replace(t)}catch(n){e.src=t}}(e,s):e.src=s),r&&(o||d)&&A(e,{src:s})),e._lazyRace&&delete e._lazyRace,p(e,a.lazyClass),w((function(){var t=e.complete&&e.naturalWidth>1;z&&!t||(t&&g(e,"ls-is-cached"),J(y),e._lazyCache=!0,u((function(){"_lazyCache"in e&&delete e._lazyCache}),9)),"lazy"==e.loading&&P--}),!0)})),Y=function(e){if(!e._lazyRace){var t,n=D.test(e.nodeName),i=n&&(e[l](a.sizesAttr)||e[l]("sizes")),r="auto"==i;(!r&&d||!n||!e[l]("src")&&!e.srcset||e.complete||v(e,a.errorClass)||!v(e,a.lazyClass))&&(t=b(e,"lazyunveilread").detail,r&&B.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,P++,X(e,t,r,i,n))}},Z=x((function(){a.loadMode=3,G()})),ee=function(){3==a.loadMode&&(a.loadMode=2),Z()},te=function(){if(!d){if(r.now()-z<999)return void u(te,999);d=!0,a.loadMode=3,G(),c("scroll",ee,!0)}};return{_:function(){z=r.now(),n.elements=t.getElementsByClassName(a.lazyClass),s=t.getElementsByClassName(a.lazyClass+" "+a.preloadClass),c("scroll",G,!0),c("resize",G,!0),e.MutationObserver?new MutationObserver(G).observe(i,{childList:!0,subtree:!0,attributes:!0}):(i[o]("DOMNodeInserted",G,!0),i[o]("DOMAttrModified",G,!0),setInterval(G,999)),c("hashchange",G,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach((function(e){t[o](e,G,!0)})),/d$|^c/.test(t.readyState)?te():(c("load",te),t[o]("DOMContentLoaded",G),u(te,2e4)),n.elements.length?(j(),w._lsFlush()):G()},checkElems:G,unveil:Y,_aLSL:ee}}(),B=function(){var e,n=N((function(e,t,n,a){var i,r,s;if(e._lazysizesWidth=a,a+="px",e.setAttribute("sizes",a),m.test(t.nodeName||""))for(r=0,s=(i=t.getElementsByTagName("source")).length;r<s;r++)i[r].setAttribute("sizes",a);n.detail.dataAttr||A(e,n.detail)})),i=function(e,t,a){var i,r=e.parentNode;r&&(a=_(e,r,a),(i=b(e,"lazybeforesizes",{width:a,dataAttr:!!t})).defaultPrevented||(a=i.detail.width)&&a!==e._lazysizesWidth&&n(e,r,i,a))},r=x((function(){var t,n=e.length;if(n)for(t=0;t<n;t++)i(e[t])}));return{_:function(){e=t.getElementsByClassName(a.autosizesClass),c("resize",r)},checkElems:r,updateElem:i}}(),L=function(){!L.i&&t.getElementsByClassName&&(L.i=!0,B._(),W._())};return u((function(){a.init&&L()})),n={cfg:a,autoSizer:B,loader:W,init:L,uP:A,aC:g,rC:p,hC:v,fire:b,gW:_,rAF:w}}(e,e.document);e.lazySizes=n,"object"==typeof module&&module.exports&&(module.exports=n)}("undefined"!=typeof window?window:{});
!function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,(function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var a=/\S/;function u(e){return!function(e,t){return s.call(e,t)}(a,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var p=/\s*/,l=/\s+/,h=/\s*=/,f=/\s*\}/,d=/#|\^|\/|>|\{|&|=|!/;function v(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function w(){this.cache={}}v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var i,s,a=this,u=!1;a;){if(e.indexOf(".")>0)for(t=a.view,i=e.split("."),s=0;null!=t&&s<i.length;)s===i.length-1&&(u=o(t,i[s])),t=t[i[s++]];else t=a.view[e],u=o(a.view,e);if(u)break;a=a.parent}n[e]=t}return r(t)&&(t=t.call(this.view)),t},w.prototype.clearCache=function(){this.cache={}},w.prototype.parse=function(t,r){var o=this.cache,s=o[t];return null==s&&(s=o[t]=function(t,r){if(!t)return[];var o,s,a,c=[],g=[],w=[],y=!1,x=!1;function k(){if(y&&!x)for(;w.length;)delete g[w.pop()];else w=[];y=!1,x=!1}function b(e){if("string"==typeof e&&(e=e.split(l,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);o=new RegExp(i(e[0])+"\\s*"),s=new RegExp("\\s*"+i(e[1])),a=new RegExp("\\s*"+i("}"+e[1]))}b(r||e.tags);for(var m,E,U,T,j,S,V=new v(t);!V.eos();){if(m=V.pos,U=V.scanUntil(o))for(var C=0,A=U.length;C<A;++C)u(T=U.charAt(C))?w.push(g.length):x=!0,g.push(["text",T,m,m+1]),m+=1,"\n"===T&&k();if(!V.scan(o))break;if(y=!0,E=V.scan(d)||"name",V.scan(p),"="===E?(U=V.scanUntil(h),V.scan(h),V.scanUntil(s)):"{"===E?(U=V.scanUntil(a),V.scan(f),V.scanUntil(s),E="&"):U=V.scanUntil(s),!V.scan(s))throw new Error("Unclosed tag at "+V.pos);if(j=[E,U,m,V.pos],g.push(j),"#"===E||"^"===E)c.push(j);else if("/"===E){if(!(S=c.pop()))throw new Error('Unopened section "'+U+'" at '+m);if(S[1]!==U)throw new Error('Unclosed section "'+S[1]+'" at '+m)}else"name"===E||"{"===E||"&"===E?x=!0:"="===E&&b(U)}if(S=c.pop())throw new Error('Unclosed section "'+S[1]+'" at '+V.pos);return function(e){for(var t,n=[],r=n,i=[],o=0,s=e.length;o<s;++o)switch((t=e[o])[0]){case"#":case"^":r.push(t),i.push(t),r=t[4]=[];break;case"/":i.pop()[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],i=0,o=e.length;i<o;++i)(t=e[i])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(g))}(t,r)),s},w.prototype.render=function(e,t,n){var r=this.parse(e),i=t instanceof g?t:new g(t);return this.renderTokens(r,i,n,e)},w.prototype.renderTokens=function(e,t,n,r){for(var i,o,s,a="",u=0,c=e.length;u<c;++u)s=void 0,"#"===(o=(i=e[u])[0])?s=this.renderSection(i,t,n,r):"^"===o?s=this.renderInverted(i,t,n,r):">"===o?s=this.renderPartial(i,t,n,r):"&"===o?s=this.unescapedValue(i,t):"name"===o?s=this.escapedValue(i,t):"text"===o&&(s=this.rawValue(i)),void 0!==s&&(a+=s);return a},w.prototype.renderSection=function(e,t,i,o){var s=this,a="",u=t.lookup(e[1]);if(u){if(n(u))for(var c=0,p=u.length;c<p;++c)a+=this.renderTokens(e[4],t.push(u[c]),i,o);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],t.push(u),i,o);else if(r(u)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(u=u.call(t.view,o.slice(e[3],e[5]),(function(e){return s.render(e,t,i)})))&&(a+=u)}else a+=this.renderTokens(e[4],t,i,o);return a}},w.prototype.renderInverted=function(e,t,r,i){var o=t.lookup(e[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(e[4],t,r,i)},w.prototype.renderPartial=function(e,t,n){if(n){var i=r(n)?n(e[1]):n[e[1]];return null!=i?this.renderTokens(this.parse(i),t,n,i):void 0}},w.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},w.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},w.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var y=new w;return e.clearCache=function(){return y.clearCache()},e.parse=function(e,t){return y.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return y.render(e,t,r)},e.to_html=function(t,n,i,o){var s=e.render(t,n,i);if(!r(o))return s;o(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=v,e.Context=g,e.Writer=w,e}));
var autoComplete=function(e){function t(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function s(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function l(e,s,l,n){o(n||document,s,(function(o){for(var s,n=o.target||o.srcElement;n&&!(s=t(n,e));)n=n.parentElement;s&&l.call(n,o)}))}if(document.querySelector){var n={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(){}};for(var c in e)e.hasOwnProperty(c)&&(n[c]=e[c]);for(var a="object"==typeof n.selector?[n.selector]:document.querySelectorAll(n.selector),u=0;u<a.length;u++){var i=a[u];i.sc=document.createElement("div"),i.sc.className="autocomplete-suggestions "+n.menuClass,i.autocompleteAttr=i.getAttribute("autocomplete"),i.setAttribute("autocomplete","off"),i.cache={},i.last_val="",i.updateSC=function(e,t){var o=i.getBoundingClientRect();if(i.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+n.offsetLeft)+"px",i.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+n.offsetTop)+"px",i.sc.style.width=Math.round(o.right-o.left)+"px",!e&&(i.sc.style.display="block",i.sc.maxHeight||(i.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(i.sc,null):i.sc.currentStyle).maxHeight)),i.sc.suggestionHeight||(i.sc.suggestionHeight=i.sc.querySelector(".autocomplete-suggestion").offsetHeight),i.sc.suggestionHeight))if(t){var s=i.sc.scrollTop,l=t.getBoundingClientRect().top-i.sc.getBoundingClientRect().top;l+i.sc.suggestionHeight-i.sc.maxHeight>0?i.sc.scrollTop=l+i.sc.suggestionHeight+s-i.sc.maxHeight:0>l&&(i.sc.scrollTop=l+s)}else i.sc.scrollTop=0},o(window,"resize",i.updateSC),document.body.appendChild(i.sc),l("autocomplete-suggestion","mouseleave",(function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&setTimeout((function(){e.className=e.className.replace("selected","")}),20)}),i.sc),l("autocomplete-suggestion","mouseover",(function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&(e.className=e.className.replace("selected","")),this.className+=" selected"}),i.sc),l("autocomplete-suggestion","mousedown",(function(e){if(t(this,"autocomplete-suggestion")){var o=this.getAttribute("data-val");i.value=o,n.onSelect(e,o,this),i.sc.style.display="none"}}),i.sc),i.blurHandler=function(){try{var e=document.querySelector(".autocomplete-suggestions:hover")}catch(t){e=0}e?i!==document.activeElement&&setTimeout((function(){i.focus()}),20):(i.last_val=i.value,i.sc.style.display="none",setTimeout((function(){i.sc.style.display="none"}),350))},o(i,"blur",i.blurHandler);var r=function(e){var t=i.value;if(i.cache[t]=e,e.length&&t.length>=n.minChars){for(var o="",s=0;s<e.length;s++)o+=n.renderItem(e[s],t);i.sc.innerHTML=o,i.updateSC(0)}else i.sc.style.display="none"};i.keydownHandler=function(e){var t,o=window.event?e.keyCode:e.which;if((40==o||38==o)&&i.sc.innerHTML)return(s=i.sc.querySelector(".autocomplete-suggestion.selected"))?(t=40==o?s.nextSibling:s.previousSibling)?(s.className=s.className.replace("selected",""),t.className+=" selected",i.value=t.getAttribute("data-val")):(s.className=s.className.replace("selected",""),i.value=i.last_val,t=0):((t=40==o?i.sc.querySelector(".autocomplete-suggestion"):i.sc.childNodes[i.sc.childNodes.length-1]).className+=" selected",i.value=t.getAttribute("data-val")),i.updateSC(0,t),!1;if(27==o)i.value=i.last_val,i.sc.style.display="none";else if(13==o||9==o){var s;(s=i.sc.querySelector(".autocomplete-suggestion.selected"))&&"none"!=i.sc.style.display&&(n.onSelect(e,s.getAttribute("data-val"),s),setTimeout((function(){i.sc.style.display="none"}),20))}},o(i,"keydown",i.keydownHandler),i.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(35>t||t>40)&&13!=t&&27!=t){var o=i.value;if(o.length>=n.minChars){if(o!=i.last_val){if(i.last_val=o,clearTimeout(i.timer),n.cache){if(o in i.cache)return void r(i.cache[o]);for(var s=1;s<o.length-n.minChars;s++){var l=o.slice(0,o.length-s);if(l in i.cache&&!i.cache[l].length)return void r([])}}i.timer=setTimeout((function(){n.source(o,r)}),n.delay)}}else i.last_val=o,i.sc.style.display="none"}},o(i,"keyup",i.keyupHandler),i.focusHandler=function(e){i.last_val="\n",i.keyupHandler(e)},n.minChars||o(i,"focus",i.focusHandler)}this.destroy=function(){for(var e=0;e<a.length;e++){var t=a[e];s(window,"resize",t.updateSC),s(t,"blur",t.blurHandler),s(t,"focus",t.focusHandler),s(t,"keydown",t.keydownHandler),s(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}};"function"==typeof define&&define.amd?define("autoComplete",(function(){return autoComplete})):"undefined"!=typeof module&&module.exports?module.exports=autoComplete:window.autoComplete=autoComplete;
"undefined"!=typeof O&&"object"==typeof O||(O={}),"base"in O||(O.base={}),O.base.dom={panels:document.querySelectorAll(".panel"),modals:document.querySelectorAll(".modal"),resources:document.querySelectorAll(".resource"),headerContainer:document.querySelector("header"),header:document.querySelector("#header"),index:document.querySelector("#index"),throbber:document.querySelector("#throbber"),fs:document.querySelector("#fs-container"),fsInput:document.querySelector("#fs input"),form:document.querySelector("form"),q:document.querySelector("form input[name=q]"),go:document.querySelector("form input[name=go]"),resourceSelector:document.querySelector("form > nav"),urlFlagSelectors:document.querySelectorAll("form .urlFlag"),communitiesSelectorArrow:document.querySelector("form .arrow-down"),communitiesSelector:document.querySelector("form .drop-down"),communityCheckBoxes:document.querySelectorAll("form input[name=communities]"),refreshCacheSelector:document.querySelector("form input[name=refreshCache]"),refreshCacheWarning:document.querySelector("form .refreshCacheWarning"),simpleSearchContainer:document.querySelector("#ss-container"),fancySearchContainer:document.querySelector("#fs-container"),toggleSearchLink:document.querySelector("#toggleSearch > a"),toggleGridLink:document.querySelector("#toggleGrid > a"),title:document.querySelector("a.title"),"modal-open":document.querySelectorAll(".modal-open"),"modal-close":document.querySelectorAll(".modal-close"),map:document.querySelector("#map"),images:{section:document.querySelector("#images"),searchCriteria:document.querySelector("#images .searchCriteria"),charts:document.querySelector("#images .charts"),results:document.querySelector("#images .results")},carousel:{section:document.querySelector("#carousel"),searchCriteria:document.querySelector("#carousel .searchCriteria"),results:document.querySelector("#carousel .results")},treatment:{section:document.querySelector("#treatment"),searchCriteria:document.querySelector("#treatment .searchCriteria"),charts:document.querySelector("#treatment .charts"),results:document.querySelector("#treatment .results")},treatments:{section:document.querySelector("#treatments"),searchCriteria:document.querySelector("#treatments .searchCriteria"),charts:document.querySelector("#treatments .charts"),results:document.querySelector("#treatments .results")},wrapper:document.querySelector("#wrapper")},O.base.templates={partials:{"template-pager":document.querySelector("#template-pager").innerHTML,"template-records-found":document.querySelector("#template-records-found").innerHTML,"template-figures":document.querySelector("#template-figures").innerHTML,"template-kein-preview":document.querySelector("#template-kein-preview").innerHTML},wholes:{images:document.querySelector("#template-images").innerHTML,carousel:document.querySelector("#template-carousel").innerHTML}},O.base.modals=Array.from(O.base.dom.modals).map(e=>e.id),O.base.resources=Array.from(O.base.dom.resources).map(e=>e.id),O.base.resource="",O.base.figcaptions=[],O.base.savedPanel={id:"",search:""},O.base.model={treatments:{},images:{}},O.base.compileTemplates=function(){log.info("compiling whole templates");for(let e in O.base.templates.wholes)Mustache.parse(O.base.templates.wholes[e]);log.info("compiling partial templates");for(let e in O.base.templates.partials)Mustache.parse(O.base.templates.partials[e])},O.base.init=function(){O.base.compileTemplates(),O.utils.addEvents(),O.utils.loadpage()};
"undefined"!=typeof O&&"object"==typeof O||(O={}),"default"in O||(O.default={}),O.default.zenodoUri="https://zenodo.org/record/",O.default.map={url:"https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets",accessToken:"pk.eyJ1IjoicHVua2lzaCIsImEiOiJjajhvOXY0dW8wMTA3MndvMzBlamlhaGZyIn0.3Ye8NRiiGyjJ1fud7VbtOA",leaflet:{}},O.default.search={},O.default.search.type="simple",O.default.search.inputs={go:{name:"go",type:"button",value:"go",search:[],browser:!1},resource:[{name:"resource",type:"radio",value:"images",checked:!0,search:["simple","fancy"],browser:!1},{name:"resource",type:"radio",value:"treatments",checked:!1,search:["simple","fancy"]}],communities:[{name:"communities",type:"checkbox",value:"biosyslit",checked:!0,search:["simple","fancy"]},{name:"communities",type:"checkbox",value:"belgiumherbarium",checked:!1,search:["simple","fancy"]}],refreshCache:{name:"refreshCache",type:"checkbox",value:!0,checked:!1,search:["simple","fancy"]},q:{name:"q",type:"text",value:"",search:["simple"]},text:{name:"text",type:"text",value:"",search:["fancy"]},doi:{name:"doi",type:"text",value:"",search:["fancy"]},author:{name:"author",type:"text",value:"",search:["fancy"]},title:{name:"title",type:"text",value:"",search:["fancy"]},size:{name:"size",type:"hidden",value:"30",search:["simple","fancy"]},page:{name:"page",type:"hidden",value:"1",search:["simple","fancy"]}},O.default.search.fancyParams=[{key:"text",values:[],prompt:"Enter text to search anywhere (full-text search)",noDuplicates:!0},{key:"title",values:[],prompt:"Enter text to search in the 'title' field",noDuplicates:!0},{key:"doi",values:[],prompt:"Enter the exact DOI of the publication",noDuplicates:!0},{key:"author",values:"https://zenodeo.punkish.org/v2/authors",prompt:"Type at lease 3 letters to get suggestions",noDuplicates:!1}],O.default.resource="images",O.default.figure={},O.default.figure.captionHeight="30px",O.default.qPlaceholder="c’mon, enter something",O.default.imagesLayout="compact";
"undefined"!=typeof O&&"object"==typeof O||(O={}),"eventlisteners"in O||(O.eventlisteners={}),O.eventlisteners.openModal=function(e){e.stopPropagation(),e.preventDefault(),O.utils.turnOffAll();const t=e.target.href.split("/").pop().split(".")[0];O.utils.turnOnById(t),history.pushState("","",`${t}.html`)},O.eventlisteners.toggle=function(e,t){const s=e.length;if("on"===t)if(s>1)for(let t=0,i=s;t<i;t++)O.utils.turnOn(e[t]);else O.utils.turnOn(e);else if("off"===t)if(s>1)for(let t=0,i=s;t<i;t++)O.utils.turnOff(e[t]);else O.utils.turnOff(e)},O.eventlisteners.toggleCommunities=function(e){O.base.dom.communitiesSelector.classList.toggle("open")},O.eventlisteners.toggleRefreshCache=function(e){O.base.dom.refreshCacheWarning.classList.toggle("visible")},O.eventlisteners.closeModal=function(e){e.stopPropagation(),e.preventDefault();for(let e=0,t=O.base.dom.modals.length;e<t;e++)O.base.dom.modals[e].classList.contains("visible")&&O.utils.turnOff(O.base.dom.modals[e]);if(O.base.savedPanel.id){O.utils.turnOnById(O.base.savedPanel.id);let e=`${O.base.savedPanel.id}.html`+(O.base.savedPanel.search||"");history.pushState("","",e)}else O.utils.turnOnById("index"),history.pushState("","","index.html")},O.eventlisteners.goHome=function(e){e.stopPropagation(),e.preventDefault(),O.utils.turnOffAll(),O.utils.turnOnById("index"),O.base.dom.q.value="",history.pushState("","","index.html")},O.eventlisteners.activateUrlFlagSelectors=function(){for(let e=0,t=O.base.dom.urlFlagSelectors.length;e<t;e++){const t=O.base.dom.urlFlagSelectors[e];t.addEventListener("click",(function(e){O.utils.chooseUrlFlags(t),"communities"===t.name&&O.base.dom.communitiesSelector.classList.remove("open")}))}},O.eventlisteners.goGetIt=function(e){if(e.stopPropagation(),e.preventDefault(),O.utils.formHasNoValidInput())return void(O.base.dom.q.placeholder=O.default.qPlaceholder);const t=O.utils.form2uris();log.info(`browserUri: ${t}`),history.pushState("","",t),O.utils.loadpage()},O.eventlisteners.toggleFigcaption=function(e){0==O.base.figcaptions.length&&(O.base.figcaptions=document.querySelectorAll("figcaption"));let t=this.parentElement.style.maxHeight;if(t===O.default.figure.captionHeight||""===t){let e=0;for(;e<O.base.figcaptions.length;e++)O.base.figcaptions[e].style.maxHeight=O.default.figure.captionHeight;this.parentElement.style.maxHeight="100%",this.parentElement.style.overflow="auto"}else this.parentElement.style.maxHeight=O.default.figure.captionHeight,this.parentElement.style.overflow="hidden"},O.eventlisteners.toggleSearch=function(e){if(O.base.searchType=O.default.search.type,this.hash){const[e,t]=this.hash.substr(1).split("=");"search"===e&&(O.base.searchType=t)}O.utils.toggleSearchType()},O.eventlisteners.toggleGrid=function(e){if(O,base.gridType=O.search.defaultGridType,this.hash){const[e,t]=this.hash.substr(1).split("=");"layout"===e&&(O.base.gridType=t)}O.utils.toggleGridType()};
"undefined"!=typeof O&&"object"==typeof O||(O={}),"images"in O||(O.images={}),O.images.makeLayout=function(e){let s=[];for(let t=0,a=e.length;t<a;t++){const a=e[t];s.push({title:a.title,creators:a.creators?a.creators.map(e=>e.name):[],recId:a.id,zenodoRecord:O.default.zenodoUri+a.id,description:a.description,doi:a.doi,img:!!a.thumbs,img10:a.thumbs?a.thumbs[10]:"",img50:a.thumbs?a.thumbs[50]:"",img100:a.thumbs?a.thumbs[100]:"",img250:a.thumbs?a.thumbs[250]:"",img750:a.thumbs?a.thumbs[750]:"",img1200:a.thumbs?a.thumbs[1200]:""})}return s},O.images.turnCarouselOn=function(e,s){O.base.dom.carousel.results.innerHTML=Mustache.render(O.base.templates.wholes.carousel,O.base.model.images,O.base.templates.partials);const t=document.querySelectorAll(".carouselOff");for(let e=0,s=t.length;e<s;e++)t[e].addEventListener("click",O.images.turnCarouselOff);const a="#"+s;history.pushState?history.pushState(null,null,a):location.hash=a,O.utils.turnOffAll(),O.eventlisteners.toggle(O.base.dom.carousel.section,"on"),history.pushState?history.pushState(null,null,""):location.hash=""},O.images.turnCarouselOff=function(e){O.utils.turnOffAll(),O.eventlisteners.toggle(O.base.dom.images.section,"on")},O.images.getImages=function(e){log.info(`getting images from ${e}`),fetch(e).then(O.utils.fetchReceive).then((function(e){if(e.value?O.base.model.images=e.value:O.base.model.images=e,"num-of-records"in O.base.model.images)if(O.base.model.images.resource="images",O.base.model.images["num-of-records"]>0){O.base.model.images.successful=!0,O.base.model.images["num-of-records"]=O.utils.niceNumbers(O.base.model.images["num-of-records"]),O.base.model.images.from=O.utils.niceNumbers(O.base.model.images.from),O.base.model.images.to<10&&(O.base.model.images.to=O.utils.niceNumbers(O.base.model.images.to).toLowerCase()),O.base.model.images.figures=O.images.makeLayout(O.base.model.images.records),O.base.model.images["search-criteria-text"]=O.utils.formatSearchCriteria(O.base.model.images["search-criteria"],O.base.model.images["num-of-records"],"images"),O.utils.makePager(O.base.model.images),O.base.dom.images.results.innerHTML=Mustache.render(O.base.templates.wholes.images,O.base.model.images,O.base.templates.partials);document.querySelector("a.density");const e=document.querySelectorAll("figcaption > a");for(let s=0,t=e.length;s<t;s++)e[s].addEventListener("click",O.eventlisteners.toggleFigcaption);const s=document.querySelectorAll(".lazyload");for(let e=0,t=s.length;e<t;e++)s[e].addEventListener("click",(function(s){O.images.turnCarouselOn(O.base.model.images,O.base.model.images.figures[e].recId)}))}else O.base.model.images.successful=!1,O.base.model.images["num-of-records"]="No",log.info("no images found"),log.info(JSON.stringify(O.base.model.images)),O.base.model.images["search-criteria-text"]=O.utils.formatSearchCriteria(O.base.model.images["search-criteria"],O.base.model.images["num-of-records"],"images"),O.base.dom.images.results.innerHTML=Mustache.render(O.base.templates.wholes.images,O.base.model.images,O.base.templates.partials);O.utils.turnOffAll(),O.eventlisteners.toggle(O.base.dom.throbber,"off"),O.eventlisteners.toggle(O.base.dom.images.section,"on")}))},O.images.changeDensity=function(){const e=document.querySelector("#masonry");let s="100";"compact"===O.base.gridType?(e.classList.remove("masonry-250"),e.classList.add("masonry-100")):"spaced"===O.base.gridType&&(e.classList.remove("masonry-100"),e.classList.add("masonry-250"),s="250");const t=e.querySelectorAll("img"),a=O.base.model.images.records;for(let e=0,o=t.length;e<o;e++){const o=t[e],i=o.dataset.recid;for(let e=0,t=a.length;e<t;e++){const t=a[e];if(a[e].id===i){o.src=t.thumbs[s];break}}}},O.images.activateGridSwitcher=function(){const e="compact"===O.base.layout?"spaced layout":"compact layout";log.info(`activating layout to switch to ${e}`),setTimeout(()=>O.base.dom.toggleGridLink.hash=`#grid=${e.replace(" layout","")}`,100),O.base.dom.toggleGridLink.innerHTML=`switch to ${e}`,O.base.dom.toggleGridLink.addEventListener("click",O.eventlisteners.toggleGrid)};
"undefined"!=typeof O&&"object"==typeof O||(O={}),"search"in O||(O.search={}),O.search.fancySearch=function(){let e,t,s,n;const a=function(e){let t=document.createElement(e.elType);return e.id&&(t.id=e.id),e.class&&(t.className=e.class),e.type&&(t.type=e.type),e.text&&(t.innerText=e.text),e.html&&(t.innerHTML=e.html),e.container.appendChild(t),t},l=function(){let e=a({elType:"div",class:"fs-param-empty",container:t});a({elType:"div",class:"fs-key fs-off",container:e});let s=a({elType:"input",class:"fs-key-input",container:e});return a({elType:"div",class:"fs-val fs-off",container:e}),[s,a({elType:"input",class:"fs-val-input fs-off",container:e}),a({elType:"div",class:"fs-cancel fs-off",text:"x",container:e})]},i=function(e){const t=(e=e||window.event).which||e.keyCode;let s=e.target,n=s.parentElement,a=(n.children[0],n.children[1],n.children[2]),i=n.children[3],c=n.children[4];if(13==t)return""!==i.value&&(n.className="fs-param-filled",a.innerText=i.value,a.className="fs-val fs-on",i.className="fs-off",c.className="fs-cancel fs-on",l()),e.preventDefault(),e.stopPropagation(),!1;if((8==t||46==t)&&""===s.value){let e=document.querySelectorAll("div.fs-param-filled"),t=e[e.length-1];t?"fs-param-filled"===t.className?t.className="fs-param-filled fs-hilite":(t.className="fs-param-filled fs-hilite")&&t.parentElement.removeChild(t):(t=(e=document.querySelectorAll("div.fs-param-empty"))[e.length-1]).parentElement.removeChild(t)}},c=function(e){const t=this.parentElement;t.parentElement.removeChild(t)},o=function(t,n,a){new autoComplete({selector:n,minChars:Array.isArray(a)?0:3,source:function(e,t){if(Array.isArray(a)){if(a.length>0){e=e.toLowerCase();let s=[],n=a.length;for(let t=0;t<n;t++)~a[t].toLowerCase().indexOf(e)&&s.push(a[t]);t(s)}}else{try{r.abort()}catch(e){}r(a+"?q="+e,t)}},onSelect:function(n,a,i){let c,r,f=this.selector,p=f.parentElement;const d=O.default.search.fancyParams,m=d.length;if("key"===t){let t=p.children[0];t.innerText=f.value+":",t.className="fs-key fs-on",f.className="fs-off";for(let e=0;e<m;e++)if(d[e].key===a){c=d[e].values,r=d[e].prompt,d[e].noDuplicates&&s.splice(s.indexOf(a),1);break}let n=p.children[3];n.className="fs-val-input fs-on",e.innerHTML=r,o("val",n,c),n.focus()}else if("val"===t){e.innerHTML="choose a facet from the dropdown";let t=p.children[2];a&&(t.innerText=f.value,t.className="fs-val fs-on"),f.className="fs-off",p.className="fs-param-filled",p.children[4].className="fs-cancel fs-on";for(let e=0;e<m;e++)if(d[e].key===a){c=d[e].values;break}l()}}})},r=function(e,t){let s=new XMLHttpRequest;s.onload=function(e){if(4===s.readyState&&200===s.status){const e=JSON.parse(s.responseText);t(e)}},s.onerror=function(e){console.error(s.statusText)},s.open("GET",e,!0),s.setRequestHeader("Content-Type","application/json;charset=UTF-8"),s.send()},f=function(e){const s=t.childNodes;let n={};for(let e=0,t=s.length;e<t;e++){const t=s[e].children,a=t[1].value,l=t[3].value.replace(/\n$/,"");if(a&&l)if(a in n)if("string"==typeof n[a]){const e=n[a];n[a]=[e,l]}else n[a].push(l);else n[a]=l}e(n)},p=function(e,s){const n=a({elType:"div",class:"fs-param-empty",container:t}),l=a({elType:"div",class:"fs-key fs-off",container:n}),i=a({elType:"input",class:"fs-key-input",container:n}),c=a({elType:"div",class:"fs-val fs-off",container:n}),o=a({elType:"input",class:"fs-val-input fs-off",container:n}),r=a({elType:"div",class:"fs-cancel fs-off",text:"x",container:n});l.innerText=e+":",l.className="fs-key fs-on",i.className="fs-off",o.className="fs-val-input fs-off",c.innerText=s,c.className="fs-val fs-on",n.className="fs-param-filled",r.className="fs-cancel fs-on"};return{init:function(r,d,m,u){theParams=d,s=d.map(e=>e.key),paramValues=d.map(e=>e.values),n=m,function(s){e=a({elType:"div",id:"fs-help",class:"fs-help",html:"choose a param from the dropdown",container:s});let l=a({elType:"div",id:"fs-widget",class:"fs-widget",container:s});t=a({elType:"div",id:"fs",class:"fs",container:l}),a({elType:"button",id:"fs-go",type:"submit",class:"fs-button-primary",text:"go",container:l}).addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),f(n)}))}(r);const h=["page","size","refreshCache"];if(u)for(let e in u){const t=u[e];if("communities"===e){let e=0;const s=O.base.dom.communityCheckBoxes.length;for(;e<s;e++){const s=O.base.dom.communityCheckBoxes[e];s.checked=t===s.value}}else h.includes(e)||p(e,t)}else{const[e,t,n]=l();!function(e,t,n){e.addEventListener("keydown",i),t.addEventListener("keydown",i),n.addEventListener("click",c),o("key",e,s),e.focus()}(e,t,n)}}}},O.search.initializeFancySearch=function(e){log.info(`initializing fancy search with state ${e}`);let t="";"filled"===e&&(t=O.utils.loc2qryObj()),(new O.search.fancySearch).init(O.base.dom.fs,O.default.search.fancyParams,O.eventlisteners.goGetIt,t)},O.search.activateSearchSwitcher=function(){const e="simple"===O.base.searchType?"fancy search":"simple search";log.info(`activating switcher to switch to ${e}`)},O.search.initializeSimpleSearch=function(e){if(log.info(`state: ${e}`),log.info(`initializing simple search with state ${e}`),O.eventlisteners.activateUrlFlagSelectors(),O.base.dom.communitiesSelector.addEventListener("click",O.eventlisteners.toggleCommunities),O.base.dom.refreshCacheSelector.addEventListener("click",O.eventlisteners.toggleRefreshCache),O.utils.suggest(O.base.dom.q),O.base.dom.go.addEventListener("click",O.eventlisteners.goGetIt),O.base.dom.form.addEventListener("submit",O.eventlisteners.goGetIt),O.search.activateSearchSwitcher(),"empty"===e)O.base.resource=O.default.resource,O.utils.setPlaceHolder(O.base.resource),O.base.dom.q.focus();else if("filled"===e){let e=location.search;"?"===e.substr(0,1)&&(e=e.substr(1));const t=e.split("&");for(let e=0,s=t.length;e<s;e++){const[s,n]=t[e].split("="),a=O.base.dom.form.querySelectorAll(`input[name=${s}`);for(let e=0,t=a.length;e<t;e++){const t=a[e];t.name===s&&("checkbox"===t.type?t.value===n&&(log.info(`setting checked of ${t.name} to 'true'`),t.checked=!0):t.value=n)}}}},O.search.setSearchType=function(e){"simple"===O.base.searchType?O.search.initializeSimpleSearch(e):"fancy"===O.base.searchType&&O.search.initializeFancySearch(e),O.utils.toggleSearchType()};
"undefined"!=typeof O&&"object"==typeof O||(O={}),"utils"in O||(O.utils={}),O.utils.statsChart=function(e,s){Chart.platform.disableCSSInjection=!0;const o=function(e,s){return e>1e6?`${Math.round(e/1e6)}M`:e>1e3?`${Math.round(e/1e3)}K`:e},t=document.querySelectorAll(`#${e} .chart`);for(let e=0,n=t.length;e<n;e++){const n=t[e].getContext("2d");new Chart(n,{type:"bar",data:{labels:Object.keys(s.charts[e].data),datasets:[{label:s.charts[e].title,data:Object.values(s.charts[e].data),datalabels:{color:"#000000",formatter:o},backgroundColor:"#ff0000",borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,callback:o}}],xAxes:[{scaleLabel:{fontSize:8}}]},responsive:!0,tooltips:{enabled:!1},legend:{display:!1}}})}},O.utils.niceNumbers=function(e){return e>9?e:["No","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"][e]},O.utils.formatSearchCriteria=function(e,s,o){const t=["communities","refreshCache","size","page","go"],n=[];for(let s in e)if(!t.includes(s)){const o=e[s];"q"===s?n.push(`<span class="crit-val">${o}</span> is in the text`):n.push(`<span class="crit-key">${s}</span> is <span class="crit-val">${o}</span>`)}let a=n.length,r="";return 1===a?r+=n[0]:2===a?r+=n.join(" and "):a>2&&(a-=1,r+=n.slice(0,a).join(", ")+", and "+n[a]),r},O.utils.turnOn=function(e){e.classList.remove("hidden"),e.classList.add("visible")},O.utils.turnOff=function(e){e.classList.remove("visible"),e.classList.add("hidden")},O.utils.turnOnById=function(e){O.utils.turnOn(document.getElementById(e))},O.utils.turnOffById=function(e){O.utils.turnOff(document.getElementById(e))},O.utils.turnOffAll=function(){for(let e=0,s=O.base.dom.panels.length;e<s;e++)O.base.dom.panels[e].classList.contains("visible")&&((O.base.resources.includes(O.base.dom.panels[e].id)||"index"===O.base.dom.panels[e].id)&&(O.base.savedPanel.id=O.base.dom.panels[e].id,O.base.savedPanel.search=location.search),O.utils.turnOff(O.base.dom.panels[e]))},O.utils.fetchReceive=function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status);return e.json()},O.utils.suggest=function(e){new autoComplete({selector:e,minChars:3,source:function(e,s){try{fetch.abort()}catch(e){}fetch(`${O.base.zenodeo}/v2/families?q=${e}`).then(O.utils.fetchReceive).then(s)}})},O.utils.makePager=function(e){if(e["num-of-records"]&&e["num-of-records"]>=O.default.search.inputs.size){const s=[],o=[];for(let t in e["search-criteria"])"page"===t?(s.push("page="+e.prevpage),o.push("page="+e.nextpage)):(s.push(t+"="+e["search-criteria"][t]),o.push(t+"="+e["search-criteria"][t]));e.prev="?"+s.join("&"),e.next="?"+o.join("&"),e.pager=!0}else e.pager=!1},O.utils.chooseUrlFlags=function(e){if("resource"===e.name){const s=O.base.dom.resourceSelector.querySelectorAll("label"),o=O.base.dom.resourceSelector.querySelectorAll("input");for(let t=0;t<s.length;t++)e.value===o[t].value?(s[t].classList.add("searchFocus"),O.utils.setPlaceHolder(e.value)):s[t].classList.remove("searchFocus")}else"refreshCache"===e.name&&(e.value=e.checked)},O.utils.parseUrl=function(){log.info("parsing url "+location.href),target=function(){return location.pathname.split(".")[0].replace(/^(\/dev)?\//,"")||"index"},query=function(){const e=new URLSearchParams(location.search),s=["communities","page","size","q","doi","author","text"],o=[];for(const[t,n]of e)s.includes(t)&&o.push(`${t}=${n}`);return o.join("&")},hash=function(){const e=new URLSearchParams(location.hash.replace(/^#/,"")),s={layout:O.default.imagesLayout,search:O.default.search.type};for(let o in s)e.has(o)&&(s[o]=e.get(o));return s},O.base.resource=target(),log.info(`- O.base.resource: ${O.base.resource}`);const e=hash();O.base.searchType=e.search,O.base.gridType=e.layout,log.info(`- O.base.searchType: ${O.base.searchType}`),log.info(`- O.base.gridType: ${O.base.gridType}`),O.base.zenodeoUri=`${O.base.zenodeo}/v2/${O.base.resource}?${query()}`,log.info(`- O.base.zenodeoUri: ${O.base.zenodeoUri}`)},O.utils.setPlaceHolder=function(e){O.base.dom.q.placeholder=`search for ${e}`},O.utils.loadpage=function(){O.utils.parseUrl(),O.base.modals.includes(O.base.resource)?O.utils.loadModal():O.base.resources.includes(O.base.resource)&&O.utils.loadResource()},O.utils.formHasNoValidInput=function(){return""===O.base.dom.q.value},O.utils.loadModal=function(){log.info(`loading modal ${O.base.resource}`),"index"===O.base.resource?(O.search.setSearchType("empty"),O.utils.turnOnById("index")):(O.utils.turnOffAll(),O.utils.turnOnById(O.base.resource))},O.utils.loadResource=function(){log.info(`loading resource ${O.base.resource}`),log.info(`zenodeoUri: ${O.base.zenodeoUri}`),O.search.setSearchType("filled"),"treatments"===O.base.resource?O.treatments.getTreatments(O.base.zenodeoUri):"images"===O.base.resource&&O.images.getImages(O.base.zenodeoUri)},O.utils.formatAuthorsList=function(e){let s="";const o=e.length;if(1===o)s+=e[0].author;else if(2===o)s+=`${e[0].author} and ${e[1].author}`;else{const t=e.slice(0,o-1),n=e[o-1].author;s+=t.map(e=>e.author).join(", ")+" and "+n}return s},O.utils.toggleSearchType=function(){log.info(`displaying ${O.base.searchType} search`),"fancy"===O.base.searchType?(O.base.dom.simpleSearchContainer.classList.remove("visible"),O.base.dom.simpleSearchContainer.classList.add("hidden"),O.base.dom.fancySearchContainer.classList.remove("hidden"),O.base.dom.fancySearchContainer.classList.add("visible"),O.base.dom.fsInput&&O.base.dom.fsInput.focus()):"simple"===O.base.searchType&&(O.base.dom.simpleSearchContainer.classList.remove("hidden"),O.base.dom.simpleSearchContainer.classList.add("visible"),O.base.dom.fancySearchContainer.classList.remove("visible"),O.base.dom.fancySearchContainer.classList.add("hidden"),O.base.dom.q&&O.base.dom.q.focus())},O.utils.toggleGridType=function(){log.info(`displaying ${O.base.searchType}`),O.images.changeDensity(),O.images.activateGridSwitcher()},O.utils.loc2qryObj=function(){const e=location.search.substr(1);if(e){const s={};return e.split("&").forEach(e=>{const[o,t]=e.split("=");s[o]=t}),s}return null},O.utils.addEvents=function(){log.info("adding open modal events");for(let e=0,s=O.base.dom["modal-open"].length;e<s;e++)O.base.dom["modal-open"][e].addEventListener("click",O.eventlisteners.openModal);log.info("adding close modal events");for(let e=0,s=O.base.dom["modal-close"].length;e<s;e++)O.base.dom["modal-close"][e].addEventListener("click",O.eventlisteners.closeModal);log.info("adding event to title"),O.base.dom.title.addEventListener("click",O.eventlisteners.goHome)},O.utils.validKeys=[{name:"author",reqd:"no",occr:"once",type:"query",zeno:"yes"},{name:"communities",reqd:"yes",occr:"many",type:"support",zeno:"yes"},{name:"doi",reqd:"no",occr:"once",type:"query",zeno:"yes"},{name:"keywords",reqd:"yes",occr:"many",type:"query",zeno:"yes"},{name:"page",reqd:"yes",occr:"once",type:"support",zeno:"yes"},{name:"q",reqd:"no",occr:"once",type:"query",zeno:"yes"},{name:"refreshCache",reqd:"no",occr:"once",type:"support",zeno:"no"},{name:"size",reqd:"yes",occr:"once",type:"support",zeno:"yes"},{name:"title",reqd:"no",occr:"once",type:"query",zeno:"yes"},{name:"treatmentId",reqd:"no",occr:"once",type:"query",zeno:"yes"}],O.utils.isZenodeoKey=function(e){for(let s=0,o=O.utils.validKeys.length;s<o;s++)if(O.utils.validKeys[s].name===e&&"yes"===O.utils.validKeys[s].zeno)return!0;return!1},O.utils.isBrowserKey=function(e){for(let s=0,o=O.utils.validKeys.length;s<o;s++)if(O.utils.validKeys[s].name===e)return!0;return!1},O.utils.browser2zenodeo=function(){return`${O.base.zenodeo}/v2/${O.base.resource}?${zenodeoParts.join("&")}`},O.utils.form2uris=function(){const e=["resource","go","refreshCache"],s=[],o=[];let t;const n=O.base.dom.form.querySelectorAll("input");for(let a=0,r=n.length;a<r;a++){const r=`${n[a].name}=${n[a].value}`;e.includes(n[a].name)||("checkbox"===n[a].type?n[a].checked&&s.push(r):n[a].value&&s.push(r)),"resource"===n[a].name&&n[a].checked&&(t=n[a].value),"checkbox"===n[a].type?n[a].checked&&O.utils.isZenodeoKey(n[a].name)&&o.push(r):n[a].value&&O.utils.isZenodeoKey(n[a].name)&&o.push(r)}const a=t+".html?"+s.join("&");return log.info(`browserUri: ${a}`),a};