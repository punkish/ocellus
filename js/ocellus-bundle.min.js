/*! lazysizes - v5.1.2 */
!function(e,t){var n=function(e,t){"use strict";var n,a;if(function(){var t,n={lazyClass:"lazyload",loadedClass:"lazyloaded",loadingClass:"lazyloading",preloadClass:"lazypreload",errorClass:"lazyerror",autosizesClass:"lazyautosizes",srcAttr:"data-src",srcsetAttr:"data-srcset",sizesAttr:"data-sizes",minSize:40,customMedia:{},init:!0,expFactor:1.5,hFac:.8,loadMode:2,loadHidden:!0,ricTimeout:0,throttleDelay:125};for(t in a=e.lazySizesConfig||e.lazysizesConfig||{},n)t in a||(a[t]=n[t])}(),!t||!t.getElementsByClassName)return{init:function(){},cfg:a,noSupport:!0};var i=t.documentElement,r=e.Date,s=e.HTMLPictureElement,o="addEventListener",l="getAttribute",c=e[o],u=e.setTimeout,d=e.requestAnimationFrame||u,f=e.requestIdleCallback,m=/^picture$/i,y=["load","error","lazyincluded","_lazyloaded"],z={},h=Array.prototype.forEach,v=function(e,t){return z[t]||(z[t]=new RegExp("(\\s|^)"+t+"(\\s|$)")),z[t].test(e[l]("class")||"")&&z[t]},g=function(e,t){v(e,t)||e.setAttribute("class",(e[l]("class")||"").trim()+" "+t)},p=function(e,t){var n;(n=v(e,t))&&e.setAttribute("class",(e[l]("class")||"").replace(n," "))},C=function(e,t,n){var a=n?o:"removeEventListener";n&&C(e,t),y.forEach((function(n){e[a](n,t)}))},b=function(e,a,i,r,s){var o=t.createEvent("Event");return i||(i={}),i.instance=n,o.initEvent(a,!r,!s),o.detail=i,e.dispatchEvent(o),o},A=function(t,n){var i;!s&&(i=e.picturefill||a.pf)?(n&&n.src&&!t[l]("srcset")&&t.setAttribute("srcset",n.src),i({reevaluate:!0,elements:[t]})):n&&n.src&&(t.src=n.src)},E=function(e,t){return(getComputedStyle(e,null)||{})[t]},_=function(e,t,n){for(n=n||e.offsetWidth;n<a.minSize&&t&&!e._lazysizesWidth;)n=t.offsetWidth,t=t.parentNode;return n},w=function(){var e,n,a=[],i=[],r=a,s=function(){var t=r;for(r=a.length?i:a,e=!0,n=!1;t.length;)t.shift()();e=!1},o=function(a,i){e&&!i?a.apply(this,arguments):(r.push(a),n||(n=!0,(t.hidden?u:d)(s)))};return o._lsFlush=s,o}(),N=function(e,t){return t?function(){w(e)}:function(){var t=this,n=arguments;w((function(){e.apply(t,n)}))}},M=function(e){var t,n=0,i=a.throttleDelay,s=a.ricTimeout,o=function(){t=!1,n=r.now(),e()},l=f&&s>49?function(){f(o,{timeout:s}),s!==a.ricTimeout&&(s=a.ricTimeout)}:N((function(){u(o)}),!0);return function(e){var a;(e=!0===e)&&(s=33),t||(t=!0,(a=i-(r.now()-n))<0&&(a=0),e||a<9?l():u(l,a))}},x=function(e){var t,n,a=function(){t=null,e()},i=function(){var e=r.now()-n;e<99?u(i,99-e):(f||a)(a)};return function(){n=r.now(),t||(t=u(i,99))}},W=function(){var s,d,f,y,z,_,W,L,S,T,F,R,D=/^img$/i,k=/^iframe$/i,H="onscroll"in e&&!/(gle|ing)bot/.test(navigator.userAgent),O=0,P=0,$=-1,I=function(e){P--,(!e||P<0||!e.target)&&(P=0)},q=function(e){return null==R&&(R="hidden"==E(t.body,"visibility")),R||!("hidden"==E(e.parentNode,"visibility")&&"hidden"==E(e,"visibility"))},U=function(e,n){var a,r=e,s=q(e);for(L-=n,F+=n,S-=n,T+=n;s&&(r=r.offsetParent)&&r!=t.body&&r!=i;)(s=(E(r,"opacity")||1)>0)&&"visible"!=E(r,"overflow")&&(a=r.getBoundingClientRect(),s=T>a.left&&S<a.right&&F>a.top-1&&L<a.bottom+1);return s},j=function(){var e,r,o,c,u,f,m,z,h,v,g,p,C=n.elements;if((y=a.loadMode)&&P<8&&(e=C.length)){for(r=0,$++;r<e;r++)if(C[r]&&!C[r]._lazyRace)if(!H||n.prematureUnveil&&n.prematureUnveil(C[r]))Y(C[r]);else if((z=C[r][l]("data-expand"))&&(f=1*z)||(f=O),v||(v=!a.expand||a.expand<1?i.clientHeight>500&&i.clientWidth>500?500:370:a.expand,n._defEx=v,g=v*a.expFactor,p=a.hFac,R=null,O<g&&P<1&&$>2&&y>2&&!t.hidden?(O=g,$=0):O=y>1&&$>1&&P<6?v:0),h!==f&&(_=innerWidth+f*p,W=innerHeight+f,m=-1*f,h=f),o=C[r].getBoundingClientRect(),(F=o.bottom)>=m&&(L=o.top)<=W&&(T=o.right)>=m*p&&(S=o.left)<=_&&(F||T||S||L)&&(a.loadHidden||q(C[r]))&&(d&&P<3&&!z&&(y<3||$<4)||U(C[r],f))){if(Y(C[r]),u=!0,P>9)break}else!u&&d&&!c&&P<4&&$<4&&y>2&&(s[0]||a.preloadAfterLoad)&&(s[0]||!z&&(F||T||S||L||"auto"!=C[r][l](a.sizesAttr)))&&(c=s[0]||C[r]);c&&!u&&Y(c)}},G=M(j),J=function(e){var t=e.target;t._lazyCache?delete t._lazyCache:(I(e),g(t,a.loadedClass),p(t,a.loadingClass),C(t,Q),b(t,"lazyloaded"))},K=N(J),Q=function(e){K({target:e.target})},V=function(e){var t,n=e[l](a.srcsetAttr);(t=a.customMedia[e[l]("data-media")||e[l]("media")])&&e.setAttribute("media",t),n&&e.setAttribute("srcset",n)},X=N((function(e,t,n,i,r){var s,o,c,d,y,z;(y=b(e,"lazybeforeunveil",t)).defaultPrevented||(i&&(n?g(e,a.autosizesClass):e.setAttribute("sizes",i)),o=e[l](a.srcsetAttr),s=e[l](a.srcAttr),r&&(d=(c=e.parentNode)&&m.test(c.nodeName||"")),z=t.firesLoad||"src"in e&&(o||s||d),y={target:e},g(e,a.loadingClass),z&&(clearTimeout(f),f=u(I,2500),C(e,Q,!0)),d&&h.call(c.getElementsByTagName("source"),V),o?e.setAttribute("srcset",o):s&&!d&&(k.test(e.nodeName)?function(e,t){try{e.contentWindow.location.replace(t)}catch(n){e.src=t}}(e,s):e.src=s),r&&(o||d)&&A(e,{src:s})),e._lazyRace&&delete e._lazyRace,p(e,a.lazyClass),w((function(){var t=e.complete&&e.naturalWidth>1;z&&!t||(t&&g(e,"ls-is-cached"),J(y),e._lazyCache=!0,u((function(){"_lazyCache"in e&&delete e._lazyCache}),9)),"lazy"==e.loading&&P--}),!0)})),Y=function(e){if(!e._lazyRace){var t,n=D.test(e.nodeName),i=n&&(e[l](a.sizesAttr)||e[l]("sizes")),r="auto"==i;(!r&&d||!n||!e[l]("src")&&!e.srcset||e.complete||v(e,a.errorClass)||!v(e,a.lazyClass))&&(t=b(e,"lazyunveilread").detail,r&&B.updateElem(e,!0,e.offsetWidth),e._lazyRace=!0,P++,X(e,t,r,i,n))}},Z=x((function(){a.loadMode=3,G()})),ee=function(){3==a.loadMode&&(a.loadMode=2),Z()},te=function(){if(!d){if(r.now()-z<999)return void u(te,999);d=!0,a.loadMode=3,G(),c("scroll",ee,!0)}};return{_:function(){z=r.now(),n.elements=t.getElementsByClassName(a.lazyClass),s=t.getElementsByClassName(a.lazyClass+" "+a.preloadClass),c("scroll",G,!0),c("resize",G,!0),e.MutationObserver?new MutationObserver(G).observe(i,{childList:!0,subtree:!0,attributes:!0}):(i[o]("DOMNodeInserted",G,!0),i[o]("DOMAttrModified",G,!0),setInterval(G,999)),c("hashchange",G,!0),["focus","mouseover","click","load","transitionend","animationend"].forEach((function(e){t[o](e,G,!0)})),/d$|^c/.test(t.readyState)?te():(c("load",te),t[o]("DOMContentLoaded",G),u(te,2e4)),n.elements.length?(j(),w._lsFlush()):G()},checkElems:G,unveil:Y,_aLSL:ee}}(),B=function(){var e,n=N((function(e,t,n,a){var i,r,s;if(e._lazysizesWidth=a,a+="px",e.setAttribute("sizes",a),m.test(t.nodeName||""))for(r=0,s=(i=t.getElementsByTagName("source")).length;r<s;r++)i[r].setAttribute("sizes",a);n.detail.dataAttr||A(e,n.detail)})),i=function(e,t,a){var i,r=e.parentNode;r&&(a=_(e,r,a),(i=b(e,"lazybeforesizes",{width:a,dataAttr:!!t})).defaultPrevented||(a=i.detail.width)&&a!==e._lazysizesWidth&&n(e,r,i,a))},r=x((function(){var t,n=e.length;if(n)for(t=0;t<n;t++)i(e[t])}));return{_:function(){e=t.getElementsByClassName(a.autosizesClass),c("resize",r)},checkElems:r,updateElem:i}}(),L=function(){!L.i&&t.getElementsByClassName&&(L.i=!0,B._(),W._())};return u((function(){a.init&&L()})),n={cfg:a,autoSizer:B,loader:W,init:L,uP:A,aC:g,rC:p,hC:v,fire:b,gW:_,rAF:w}}(e,e.document);e.lazySizes=n,"object"==typeof module&&module.exports&&(module.exports=n)}("undefined"!=typeof window?window:{});
!function(e,t){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):(e.Mustache={},t(e.Mustache))}(this,(function(e){var t=Object.prototype.toString,n=Array.isArray||function(e){return"[object Array]"===t.call(e)};function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function o(e,t){return null!=e&&"object"==typeof e&&t in e}var s=RegExp.prototype.test;var a=/\S/;function u(e){return!function(e,t){return s.call(e,t)}(a,e)}var c={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};var p=/\s*/,l=/\s+/,h=/\s*=/,f=/\s*\}/,d=/#|\^|\/|>|\{|&|=|!/;function v(e){this.string=e,this.tail=e,this.pos=0}function g(e,t){this.view=e,this.cache={".":this.view},this.parent=t}function w(){this.cache={}}v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(e){var t=this.tail.match(e);if(!t||0!==t.index)return"";var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},v.prototype.scanUntil=function(e){var t,n=this.tail.search(e);switch(n){case-1:t=this.tail,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,n),this.tail=this.tail.substring(n)}return this.pos+=t.length,t},g.prototype.push=function(e){return new g(e,this)},g.prototype.lookup=function(e){var t,n=this.cache;if(n.hasOwnProperty(e))t=n[e];else{for(var i,s,a=this,u=!1;a;){if(e.indexOf(".")>0)for(t=a.view,i=e.split("."),s=0;null!=t&&s<i.length;)s===i.length-1&&(u=o(t,i[s])),t=t[i[s++]];else t=a.view[e],u=o(a.view,e);if(u)break;a=a.parent}n[e]=t}return r(t)&&(t=t.call(this.view)),t},w.prototype.clearCache=function(){this.cache={}},w.prototype.parse=function(t,r){var o=this.cache,s=o[t];return null==s&&(s=o[t]=function(t,r){if(!t)return[];var o,s,a,c=[],g=[],w=[],y=!1,x=!1;function k(){if(y&&!x)for(;w.length;)delete g[w.pop()];else w=[];y=!1,x=!1}function b(e){if("string"==typeof e&&(e=e.split(l,2)),!n(e)||2!==e.length)throw new Error("Invalid tags: "+e);o=new RegExp(i(e[0])+"\\s*"),s=new RegExp("\\s*"+i(e[1])),a=new RegExp("\\s*"+i("}"+e[1]))}b(r||e.tags);for(var m,E,U,T,j,S,V=new v(t);!V.eos();){if(m=V.pos,U=V.scanUntil(o))for(var C=0,A=U.length;C<A;++C)u(T=U.charAt(C))?w.push(g.length):x=!0,g.push(["text",T,m,m+1]),m+=1,"\n"===T&&k();if(!V.scan(o))break;if(y=!0,E=V.scan(d)||"name",V.scan(p),"="===E?(U=V.scanUntil(h),V.scan(h),V.scanUntil(s)):"{"===E?(U=V.scanUntil(a),V.scan(f),V.scanUntil(s),E="&"):U=V.scanUntil(s),!V.scan(s))throw new Error("Unclosed tag at "+V.pos);if(j=[E,U,m,V.pos],g.push(j),"#"===E||"^"===E)c.push(j);else if("/"===E){if(!(S=c.pop()))throw new Error('Unopened section "'+U+'" at '+m);if(S[1]!==U)throw new Error('Unclosed section "'+S[1]+'" at '+m)}else"name"===E||"{"===E||"&"===E?x=!0:"="===E&&b(U)}if(S=c.pop())throw new Error('Unclosed section "'+S[1]+'" at '+V.pos);return function(e){for(var t,n=[],r=n,i=[],o=0,s=e.length;o<s;++o)switch((t=e[o])[0]){case"#":case"^":r.push(t),i.push(t),r=t[4]=[];break;case"/":i.pop()[5]=t[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(t)}return n}(function(e){for(var t,n,r=[],i=0,o=e.length;i<o;++i)(t=e[i])&&("text"===t[0]&&n&&"text"===n[0]?(n[1]+=t[1],n[3]=t[3]):(r.push(t),n=t));return r}(g))}(t,r)),s},w.prototype.render=function(e,t,n){var r=this.parse(e),i=t instanceof g?t:new g(t);return this.renderTokens(r,i,n,e)},w.prototype.renderTokens=function(e,t,n,r){for(var i,o,s,a="",u=0,c=e.length;u<c;++u)s=void 0,"#"===(o=(i=e[u])[0])?s=this.renderSection(i,t,n,r):"^"===o?s=this.renderInverted(i,t,n,r):">"===o?s=this.renderPartial(i,t,n,r):"&"===o?s=this.unescapedValue(i,t):"name"===o?s=this.escapedValue(i,t):"text"===o&&(s=this.rawValue(i)),void 0!==s&&(a+=s);return a},w.prototype.renderSection=function(e,t,i,o){var s=this,a="",u=t.lookup(e[1]);if(u){if(n(u))for(var c=0,p=u.length;c<p;++c)a+=this.renderTokens(e[4],t.push(u[c]),i,o);else if("object"==typeof u||"string"==typeof u||"number"==typeof u)a+=this.renderTokens(e[4],t.push(u),i,o);else if(r(u)){if("string"!=typeof o)throw new Error("Cannot use higher-order sections without the original template");null!=(u=u.call(t.view,o.slice(e[3],e[5]),(function(e){return s.render(e,t,i)})))&&(a+=u)}else a+=this.renderTokens(e[4],t,i,o);return a}},w.prototype.renderInverted=function(e,t,r,i){var o=t.lookup(e[1]);if(!o||n(o)&&0===o.length)return this.renderTokens(e[4],t,r,i)},w.prototype.renderPartial=function(e,t,n){if(n){var i=r(n)?n(e[1]):n[e[1]];return null!=i?this.renderTokens(this.parse(i),t,n,i):void 0}},w.prototype.unescapedValue=function(e,t){var n=t.lookup(e[1]);if(null!=n)return n},w.prototype.escapedValue=function(t,n){var r=n.lookup(t[1]);if(null!=r)return e.escape(r)},w.prototype.rawValue=function(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var y=new w;return e.clearCache=function(){return y.clearCache()},e.parse=function(e,t){return y.parse(e,t)},e.render=function(e,t,r){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+(n(i=e)?"array":typeof i)+'" was given as the first argument for mustache#render(template, view, partials)');var i;return y.render(e,t,r)},e.to_html=function(t,n,i,o){var s=e.render(t,n,i);if(!r(o))return s;o(s)},e.escape=function(e){return String(e).replace(/[&<>"'`=\/]/g,(function(e){return c[e]}))},e.Scanner=v,e.Context=g,e.Writer=w,e}));
var autoComplete=function(e){function t(e,t){return e.classList?e.classList.contains(t):new RegExp("\\b"+t+"\\b").test(e.className)}function o(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener(t,o)}function s(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener(t,o)}function l(e,s,l,n){o(n||document,s,(function(o){for(var s,n=o.target||o.srcElement;n&&!(s=t(n,e));)n=n.parentElement;s&&l.call(n,o)}))}if(document.querySelector){var n={selector:0,source:0,minChars:3,delay:150,offsetLeft:0,offsetTop:1,cache:1,menuClass:"",renderItem:function(e,t){t=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");var o=new RegExp("("+t.split(" ").join("|")+")","gi");return'<div class="autocomplete-suggestion" data-val="'+e+'">'+e.replace(o,"<b>$1</b>")+"</div>"},onSelect:function(){}};for(var c in e)e.hasOwnProperty(c)&&(n[c]=e[c]);for(var a="object"==typeof n.selector?[n.selector]:document.querySelectorAll(n.selector),u=0;u<a.length;u++){var i=a[u];i.sc=document.createElement("div"),i.sc.className="autocomplete-suggestions "+n.menuClass,i.autocompleteAttr=i.getAttribute("autocomplete"),i.setAttribute("autocomplete","off"),i.cache={},i.last_val="",i.updateSC=function(e,t){var o=i.getBoundingClientRect();if(i.sc.style.left=Math.round(o.left+(window.pageXOffset||document.documentElement.scrollLeft)+n.offsetLeft)+"px",i.sc.style.top=Math.round(o.bottom+(window.pageYOffset||document.documentElement.scrollTop)+n.offsetTop)+"px",i.sc.style.width=Math.round(o.right-o.left)+"px",!e&&(i.sc.style.display="block",i.sc.maxHeight||(i.sc.maxHeight=parseInt((window.getComputedStyle?getComputedStyle(i.sc,null):i.sc.currentStyle).maxHeight)),i.sc.suggestionHeight||(i.sc.suggestionHeight=i.sc.querySelector(".autocomplete-suggestion").offsetHeight),i.sc.suggestionHeight))if(t){var s=i.sc.scrollTop,l=t.getBoundingClientRect().top-i.sc.getBoundingClientRect().top;l+i.sc.suggestionHeight-i.sc.maxHeight>0?i.sc.scrollTop=l+i.sc.suggestionHeight+s-i.sc.maxHeight:0>l&&(i.sc.scrollTop=l+s)}else i.sc.scrollTop=0},o(window,"resize",i.updateSC),document.body.appendChild(i.sc),l("autocomplete-suggestion","mouseleave",(function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&setTimeout((function(){e.className=e.className.replace("selected","")}),20)}),i.sc),l("autocomplete-suggestion","mouseover",(function(){var e=i.sc.querySelector(".autocomplete-suggestion.selected");e&&(e.className=e.className.replace("selected","")),this.className+=" selected"}),i.sc),l("autocomplete-suggestion","mousedown",(function(e){if(t(this,"autocomplete-suggestion")){var o=this.getAttribute("data-val");i.value=o,n.onSelect(e,o,this),i.sc.style.display="none"}}),i.sc),i.blurHandler=function(){try{var e=document.querySelector(".autocomplete-suggestions:hover")}catch(t){e=0}e?i!==document.activeElement&&setTimeout((function(){i.focus()}),20):(i.last_val=i.value,i.sc.style.display="none",setTimeout((function(){i.sc.style.display="none"}),350))},o(i,"blur",i.blurHandler);var r=function(e){var t=i.value;if(i.cache[t]=e,e.length&&t.length>=n.minChars){for(var o="",s=0;s<e.length;s++)o+=n.renderItem(e[s],t);i.sc.innerHTML=o,i.updateSC(0)}else i.sc.style.display="none"};i.keydownHandler=function(e){var t,o=window.event?e.keyCode:e.which;if((40==o||38==o)&&i.sc.innerHTML)return(s=i.sc.querySelector(".autocomplete-suggestion.selected"))?(t=40==o?s.nextSibling:s.previousSibling)?(s.className=s.className.replace("selected",""),t.className+=" selected",i.value=t.getAttribute("data-val")):(s.className=s.className.replace("selected",""),i.value=i.last_val,t=0):((t=40==o?i.sc.querySelector(".autocomplete-suggestion"):i.sc.childNodes[i.sc.childNodes.length-1]).className+=" selected",i.value=t.getAttribute("data-val")),i.updateSC(0,t),!1;if(27==o)i.value=i.last_val,i.sc.style.display="none";else if(13==o||9==o){var s;(s=i.sc.querySelector(".autocomplete-suggestion.selected"))&&"none"!=i.sc.style.display&&(n.onSelect(e,s.getAttribute("data-val"),s),setTimeout((function(){i.sc.style.display="none"}),20))}},o(i,"keydown",i.keydownHandler),i.keyupHandler=function(e){var t=window.event?e.keyCode:e.which;if(!t||(35>t||t>40)&&13!=t&&27!=t){var o=i.value;if(o.length>=n.minChars){if(o!=i.last_val){if(i.last_val=o,clearTimeout(i.timer),n.cache){if(o in i.cache)return void r(i.cache[o]);for(var s=1;s<o.length-n.minChars;s++){var l=o.slice(0,o.length-s);if(l in i.cache&&!i.cache[l].length)return void r([])}}i.timer=setTimeout((function(){n.source(o,r)}),n.delay)}}else i.last_val=o,i.sc.style.display="none"}},o(i,"keyup",i.keyupHandler),i.focusHandler=function(e){i.last_val="\n",i.keyupHandler(e)},n.minChars||o(i,"focus",i.focusHandler)}this.destroy=function(){for(var e=0;e<a.length;e++){var t=a[e];s(window,"resize",t.updateSC),s(t,"blur",t.blurHandler),s(t,"focus",t.focusHandler),s(t,"keydown",t.keydownHandler),s(t,"keyup",t.keyupHandler),t.autocompleteAttr?t.setAttribute("autocomplete",t.autocompleteAttr):t.removeAttribute("autocomplete"),document.body.removeChild(t.sc),t=null}}}};"function"==typeof define&&define.amd?define("autoComplete",(function(){return autoComplete})):"undefined"!=typeof module&&module.exports?module.exports=autoComplete:window.autoComplete=autoComplete;
"use strict";"undefined"!=typeof O&&"object"==typeof O||(O={}),O["num-of-records"]={images:0,treatments:0,citations:0},O.logger=function(e,o){const t="-".repeat(50);log.info(t),log.info(`${e}: ${o}`),log.info(t)},O.init=function(){const e=["treatments","citations","images"],o=["about","ip","contact","privacy"];O.addEventHandlers([{selectors:document.querySelectorAll(".modal-open"),action:"click",handler:{name:"openModal()",fn:O.openModal}},{selectors:document.querySelectorAll(".modal-close"),action:"click",handler:{name:"closeModal()",fn:O.closeModal}}]);const{hash:t,resource:n,search:s}=O.resourceFromUrl(location);if(O.closedForMaintenance){"index"===n||e.includes(n)?O.show("closedForMaintenance"):o.includes(n)&&O.show(n)}else O.addEventHandlers([{selectors:[document.querySelector("#searcher")],action:"submit",handler:{name:"getResource()",fn:O.getResource}},{selectors:[document.querySelector("input[name=submit]")],action:"click",handler:{name:"getResource()",fn:O.getResource}},{selectors:document.querySelectorAll("input[name=resource]"),action:"click",handler:{name:"selectResource()",fn:O.selectResource}},{selectors:[document.querySelector("input[name=refreshCache]"),document.querySelector("input[name=communitiesChooser]")],action:"click",handler:{name:"toggler()",fn:O.toggler}}]),o.includes(n)?O.show(n):(O.show("searcher"),new autoComplete({selector:document.querySelector("input[name=q]"),minChars:3,source:function(e,o){try{fetch.abort()}catch(e){}fetch(`${O.zenodeoUri}/families?q=${e}`).then(O.fetchReceive).then(o)}}),"index"===n?(O.setP(document.querySelector("input[name=resource]:checked").value),O.show("index")):e.includes(n)&&(s?O.fillSearchForm(s,n):(O._selectResource(n),O.setP(n),O.show(n))))},O.addEventHandlers=function(e){O.logger("addEventHandlers()","adding event handlers");for(let o=0,t=e.length;o<t;o++){const{selectors:t,action:n,handler:s}=e[o];for(let e=0,o=t.length;e<o;e++){const o=t[e],c=o.name||o.id||`${o.nodeName}.${o.pathname.split("/").pop()}`;log.info(`- added ${s.name} to ${c}`),o.addEventListener(n,s.fn)}}},O.toggler=function(e){const o=e.target.name,t=document.querySelector(`#${o}`);t.classList.contains("hidden-none")?(t.classList.add("visible-block"),t.classList.remove("hidden-none")):t.classList.contains("hidden-block")?(t.classList.add("visible-block"),t.classList.remove("hidden-block")):t.classList.contains("visible-block")&&(t.classList.add("hidden-block"),t.classList.remove("visible-block"))},O.openModal=function(e){const o=document.querySelectorAll("main section");for(let e=0,t=o.length;e<t;e++)O.hide(o[e].id);const t=e.target.href.split("/").pop().split(".").shift(),n=`${t}.html`;history.pushState(null,null,n),O.show(t),e.stopPropagation(),e.preventDefault()},O.closeModal=function(e){let o=e.target.parentElement.id;O.hide(o),O.closedForMaintenance?o="closedForMaintenance":(o="index",O.show("searcher"));const t=O.closedForMaintenance?"index.html":`${o}.html`;history.pushState(null,null,t),O.show(o),e.stopPropagation(),e.preventDefault()},O.show=function(e){log.info(`showing ${e}`);const o=document.querySelector(`#${e}`);o.classList.add("visible-block"),o.classList.remove("hidden-none")},O.hide=function(e){log.info(`hiding ${e}`);const o=document.querySelector(`#${e}`);o.classList.add("hidden-none"),o.classList.remove("visible-block")},O.formatSearchCriteria=function(e){const o=["resource","communities","communitiesChooser","refreshCache","size","page","reset","submit"],t=[];for(let n in e)if(!o.includes(n)){const o=e[n];"q"===n?32===e[n].length?"treatments"===e.resource?t.push(`<span class="crit-key">treatmentId</span> is <span class="crit-val">${o}</span>`):"citations"===e.resource&&t.push(`<span class="crit-key">bibRefCitationId</span> is <span class="crit-val">${o}</span>`):t.push(`<span class="crit-val">${o}</span> is in the text`):t.push(`<span class="crit-key">${n}</span> is <span class="crit-val">${o}</span>`)}let n=t.length,s="";return 1===n?s+=t[0]:2===n?s+=t.join(" and "):n>2&&(n-=1,s+=t.slice(0,n).join(", ")+", and "+t[n]),s},O.toggleFigcaption=function(e){const o=document.querySelectorAll("figcaption");for(let e=0,t=o.length;e<t;e++)o[e].style.maxHeight="30px",o[e].style.overflow="hidden";const t=this.parentElement;t.style.maxHeight="100%",t.style.overflow="auto"},O.resourceFromUrl=function(e){const{hash:o,pathname:t,search:n}=e;O.logger("resourceFromUri()",e);const s=t.split("/").pop().split(".")[0]||"index";return log.info(`- hash: ${o}`),log.info(`- resource: ${s}`),log.info(`- search: ${n}`),{hash:o,resource:s,search:n}},O.resourceFromForm=function(e){return document.querySelector("input[name=resource]:checked").value},O.resourceFromModalClick=function(e){const o=e.target.href;if(O.logger("resourceFromUri()",loc),log.info(`- href: ${o}`),o)return o.split("/").pop().split(".").shift()},O._selectResource=function(e){const o=document.querySelectorAll("#resourceChooser label"),t=document.querySelectorAll("#resourceChooser input");for(let n=0,s=o.length;n<s;n++)t[n].value===e?(t[n].checked=!0,o[n].classList.add("searchfocus")):(t[n].checked=!1,o[n].classList.remove("searchfocus"))},O.selectResource=function(e){const o=e.target.value;log.info(`selected resource ${o}`),O._selectResource(o),O.setP(o)},O.setP=function(e){O["num-of-records"][e]?O.setPlaceHolder({"num-of-records":O["num-of-records"][e],resource:e}):O.getFoo({resource:e,inputs:null,cb:O.setPlaceHolder})},O.setPlaceHolder=function(e){0==O["num-of-records"][e.resource]&&(O["num-of-records"][e.resource]=e["num-of-records"]);const o=`search ${e["num-of-records"]} ${e.resource}`;log.info(`placeholder: "${o}"`);const t=document.querySelector("input[name=q]");t.placeholder=o,t.focus()},O.fetchReceive=function(e){if(!e.ok)throw new Error("HTTP error, status = "+e.status);return e.json()},O.hls=function(e){const o=document.querySelectorAll("input[name=resource");for(let t=0,n=o.length;t<n;t++){const n=o[t],s=n.parentElement;n.value===e?(log.info(`setting checked of ${n.value} to true`),n.checked=!0,s.classList.add("searchfocus")):(n.checked=!1,s.classList.remove("searchfocus"))}},O.fillSearchForm=function(e,o){O.logger("fillSearchForm()","filling search form"),log.info(`- search: ${e}`),log.info(`- resource: ${o}`);const t=["communities","page","size","q","doi","author","text"],n=document.querySelector("#searcher"),s=new URLSearchParams(e);for(const[e,o]of s)if(t.includes(e)){const t=n.querySelectorAll(`input[name=${e}]`);for(let e=0,n=t.length;e<n;e++){const n=t[e];"checkbox"===n.type?n.value===o&&(log.info(`setting checked of ${n.name} with value ${n.value} to 'true'`),n.checked=!0):n.value=o}}O.hls(o),O.getResource()};
"use strict";"undefined"!=typeof O&&"object"==typeof O||(O={}),O.getCitations=function(t){const e=t.inputs,o=t.cb;fetch(e?"js/_erica.js":"js/_none.js").then(O.fetchReceive).then((function(t){const i={successful:!0,resource:"citations","num-of-records":t.hits.total,"search-criteria-text":e?O.formatSearchCriteria(e):"",from:e?1:"",to:e?30:"",figures:e?O.makeCitationsLayout(t.hits.hits):[]};e?o(i):(O["num-of-records"].citations=i["num-of-records"],o("citations",i["num-of-records"]))}))},O.makeCitationsLayout=function(t){return[]},O.renderCitations=function(t){};
"use strict";"undefined"!=typeof O&&"object"==typeof O||(O={});
"use strict";"undefined"!=typeof O&&"object"==typeof O||(O={});
"use strict";"undefined"!=typeof O&&"object"==typeof O||(O={}),O.niceNumbers=function(e){return e>9?e:["No","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"][e]},O.renderResults=function(e){const t=e.resource,r=e.template,n=document.querySelector(`#${t} div.result`),o=document.querySelector(`#template-${r}`).innerHTML,s={"template-pager":document.querySelector("#template-pager").innerHTML,"template-records-found":document.querySelector("#template-records-found").innerHTML,"template-kein-preview":document.querySelector("#template-kein-preview").innerHTML};n.innerHTML=Mustache.render(o,e,s);const i=document.querySelectorAll("figcaption > a");for(let e=0,t=i.length;e<t;e++)i[e].addEventListener("click",O.toggleFigcaption);return e.resource},O.getResource=function(e){e&&(e.stopPropagation(),e.preventDefault());const t=document.querySelector("#searcher"),r=t.elements,n=t.querySelector("input[name=q]");if(""===n.value)return n.placeholder="c‘mon, enter something",n.classList.remove("nudge"),n.classList.add("warning"),n.focus(),!1;n.classList.remove("warning"),n.classList.add("nudge");const o={};for(let e=0,n=r.length;e<n;e++){const r=t[e];if(r.name){const e=r.name,t=r.value,n=r.type,s=r.checked;"checkbox"===n?s&&(e in o?o[e].push(t):o[e]=[t]):"radio"===n?s&&(o[e]=t):o[e]=t}}O.getFoo({resource:document.querySelector("input[name=resource]:checked").value,inputs:o,cb:O.renderResults})},O.noThrob=function(e){const t=document.querySelectorAll("main section");for(let r=0,n=t.length;r<n;r++){const n=t[r].id;n!==e&&O.hide(n)}document.querySelector("#throbber").classList.add("nothrob")},O.getFoo=function(e){const{resource:t,inputs:r,cb:n}=e,{z:o,b:s}=O.inputs2uris(r,t);let i;O.logger("getFoo()",`getting ${t}`),log.info(`zenodeoUri: ${o}`),log.info(`browserUri: ${s}`),document.querySelector("#throbber").classList.remove("nothrob"),r&&(i=r?O.formatSearchCriteria(r):"",O.waitMessage(t,i),history.pushState(null,null,s),O.show(t));try{fetch(o).then(O.fetchReceive).then((function(e){log.info(e);const n=e.value,o=n["num-of-records"],c={resource:t,"num-of-records":o};if(r){const e=30;c.successful=!0,c["search-criteria-text"]=i,32===r.q.length?("treatments"===n["search-criteria"].resource?c.template="treatment":"citations"===n["search-criteria"].resource&&(c.template="citation"),o&&(c.figures=n.records[0])):(c.template=c.resource,o?(c.shown=1==o?"it is shown below":o>1&&o<=e?`${O.niceNumbers(n.from)} to ${O.niceNumbers(o)} are shown below`:`${O.niceNumbers(n.from)} to ${O.niceNumbers(n.to)} are shown below`,c.figures=function(e,t){let r=[];if("treatments"===e)for(let e=0,n=t.length;e<n;e++){const n=t[e];n.recId=n.treatmentId,r.push(n)}else if("images"===e)for(let e=0,n=t.length;e<n;e++){const n=t[e];r.push({title:n.metadata.title,creators:n.metadata.creators?n.metadata.creators.map(e=>e.name):[],recId:n.id,zenodoRecord:O.zenodoUri+n.id,description:n.metadata.description,doi:n.doi,img:!!n.links.thumbs,img10:n.links.thumbs?n.links.thumbs[10]:"",img50:n.links.thumbs?n.links.thumbs[50]:"",img100:n.links.thumbs?n.links.thumbs[100]:"",img250:n.links.thumbs?n.links.thumbs[250]:"",img750:n.links.thumbs?n.links.thumbs[750]:"",img1200:n.links.thumbs?n.links.thumbs[1200]:""})}else if("citations"===e)for(let e=0,n=t.length;e<n;e++){const n=t[e];n.recId=n.bibRefCitationId,r.push(n)}return r}(t,n.records),c.niceNumbers=O.niceNumbers(o),o>=e&&(c.prev=s.replace(/page=\d+/,`page=${n.prevpage}`),c.next=s.replace(/page=\d+/,`page=${n.nextpage}`),c.pager=!0)):(c.pager=!1,c.figures=[]))}return c})).then(n).then(O.noThrob)}catch(e){log.error(e)}},O.waitMessage=function(e,t){const r=document.querySelector(`#${e}`);O.show(e),r.querySelector(".result").innerHTML=`<p id="records-found" class="records-found">Looking for ${e} where ${t}</p>`},O.inputs2uris=function(e,t){const r={images:["q","size","page","communities","refreshCache"],treatments:["q","size","page","refreshCache"],citations:["q","size","page","refreshCache"]},n={images:["q","size","page","communities"],treatments:["q","size","page"],citations:["q","size","page"]},o=[],s=[];for(const i in e)r[t].includes(i)&&("q"===i?32==i.length?"treaments"===t?o.push(`treatmentId=${e[i]}`):"citations"===t&&o.push(`bibRefCitationId=${e[i]}`):o.push(`q=${e[i]}`):o.push(`${i}=${e[i]}`)),n[t].includes(i)&&s.push(`${i}=${e[i]}`);const i=o.length?`?${o.sort().join("&")}`:"";return{z:`${O.zenodeoUri}/${t}${i}`,b:`${t}.html${s.length?`?${s.join("&")}`:""}`}};